import h from"fs";import x from"path";import H from"sass";import W from"@babel/core";import v from"chokidar";import{PurgeCSS as X}from"purgecss";import k from"fs";import J from"path";import Q from"handlebars";import g from"fs";import L from"js-yaml";import $ from"path";import T from"sharp";import K from"svgo";var w=class{createDirectory=e=>!g.existsSync(e)&&g.mkdirSync(e);loadFiles=(e,s,t)=>(t||(t=[]),s||(s=[]),g.readdirSync(e).forEach(o=>{if(g.statSync(`${e}/${o}`).isDirectory()){let a=!1;s.forEach(n=>{n===o&&(a=!0)}),a||t.concat(this.loadFiles(`${e}/${o}`,s,t))}else t.push(`${e}/${o}`)}),t);optimizeImg=(e,s)=>{let t=K.optimize;switch($.extname(e)){case".jpg":case".jpeg":{T(e).jpeg({mozjpeg:!0}).toFile(`${s}/${$.basename(e)}`);break}case".png":{T(e).png({quality:80}).toFile(`${s}/${$.basename(e)}`);break}case".gif":{T(e).gif({reoptimize:!0}).toFile(`${s}/${$.basename(e)}`);break}case".webp":{T(e).webp({lossless:!0}).toFile(`${s}/${$.basename(e)}`);break}case".svg":{let o=g.readFileSync(e,"utf8");g.writeFileSync(`${s}/${$.basename(e)}`,t(o).data);break}}};logHeading=()=>{let e=JSON.parse(g.readFileSync("./node_modules/blockit-builder/package.json","utf-8"));console.log(`
${e.title} v${e.version} running on Node.js ${process.version}
`),process.argv.pop()!=="--build"&&(console.log("    builder url:    \x1B[35mhttp://localhost:3001   \x1B[0m"),console.log(`    preview url:    \x1B[35mhttp://localhost:3000
 \x1B[0m`),console.log(`${this.logTime(new Date)} - Waiting for changes...`))};logMessage=(e,s)=>{let t=JSON.parse(g.readFileSync("package.json","utf-8"));e==="begin"&&console.log("\x1B[33mProcessing...\x1B[0m"),e==="end"&&(process.stdout.moveCursor(0,-1),console.log(`${this.logTime(new Date)} - ${s}`)),e==="completed"&&console.log(`
\x1B[7m\x1B[32m DONE \x1B[0m\x1B[32m Project "${t.title}" ready.\x1B[0m
`)};logTime=e=>`\x1B[36m[${new Intl.DateTimeFormat("en",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h24"}).format(e)}]\x1B[0m`;frontmatter=(e,s)=>{let t=/(^-{3}(?:\r\n|\r|\n)([\w\W]*?)-{3}(?:\r\n|\r|\n))?([\w\W]*)*/;s=s||{};let o={data:null,content:""},a=e.match(t);if(a[2]!==void 0){let n=s.safeLoad?L.safeLoad:L.load;o.data=n(a[2])||{}}return a[3]!==void 0&&(o.content=a[3]),o};debounce=(e,s=800)=>{let t;return(...o)=>{clearTimeout(t),t=setTimeout(()=>{e.apply(this,o)},s)}};trimString(e){let s=e.indexOf(" ",150);return s===-1?e:e.substring(0,s)+" ..."}compareObj=e=>function(s){return e.filter(t=>t.name===s.name&&t.email===s.email&&t.role===s.role&&t.avatar===s.avatar).length===0};checkHook(){return g.readdirSync("./src/hooks","utf-8").length!==0}hookSearch=()=>{g.existsSync("./src/hooks/blog/search-post.hbs")&&g.existsSync("./src/hooks/blog/search-result.hbs")?this.hookSearchWrite("./src/hooks/blog/search-post.hbs","./src/hooks/blog/search-result.hbs"):this.hookSearchWrite("./node_modules/blockit-builder/hooks/blog/search-post.hbs","./node_modules/blockit-builder/hooks/blog/search-result.hbs")};hookSearchWrite=(e,s)=>{let t=g.readFileSync(e,"utf8"),o=g.readFileSync(s,"utf8");g.readFile("./src/assets/js/utilities/blog.js","utf8",(a,n)=>{let r=/(?<=notFoundDiv.innerHTML\s=\s`)([^`]*)(?=`)/,l=/(?<=return\s`)([^`]*)(?=`)/g,m=n.replace(r,o).replace(l,t);g.writeFileSync("./src/assets/js/utilities/blog.js",m)})};hookSections=()=>{let e=g.readdirSync("./src/hooks/sections","utf-8").filter(o=>o.match(/.(hbs)$/i)),s=g.readdirSync("./src/hooks/sections/previews","utf-8"),t=e.length===0?!1:e[0].split("-")[1];if(e.length!==0){let o=e.filter(a=>a.includes(t)).sort((a,n)=>a.length-n.length).map(a=>({sectionName:a.split(".")[0],sectionTag:g.readFileSync(`./src/hooks/sections/${a}`,"utf8")}));g.writeFileSync(`./node_modules/blockit-builder/templates/section-${t}.json`,JSON.stringify(o,null,4))}s.length!==0&&s.forEach(o=>{g.copyFileSync(`./src/hooks/sections/previews/${o}`,`./node_modules/blockit-builder/assets/img/sections/${o}`)})};hookSectionsRemove=e=>{if($.extname(e)===".hbs"&&g.readdirSync("./src/hooks/sections","utf8").length===1){let s=$.basename(e,".hbs").split("-").slice(0,-1).join("-");g.existsSync(`./node_modules/blockit-builder/templates/${s}.json`)&&g.unlinkSync(`./node_modules/blockit-builder/templates/${s}.json`)}$.extname(e)===".webp"&&g.unlinkSync(`./node_modules/blockit-builder/assets/img/sections/${$.basename(e)}`)}};function I(y,e,s){return y===!1&&e===!1?s.inverse(this):y===!0&&e===!1?s.fn(this):y===!1&&e===!0?s.fn(this):s.fn(this)}function R(y,e,s){return y===e?s.fn(this):s.inverse(this)}function z(y){return function(){let e=Array.prototype.slice.call(arguments),s=e.slice(0,-1),t=e[e.length-1];for(let o in s)if(s[o]===y)return t.fn(this);return""}}function q(y){return function(){let e=Array.prototype.slice.call(arguments),s=e.slice(0,-1),t=e[e.length-1];for(let o in s)if(s[o]===y)return"";return t.fn(this)}}var P=class{constructor(e){this.Handlebars=Q,this.options=e,this.utils=new w}loadPartials=e=>{this.utils.loadFiles(e).forEach(t=>{let o=J.basename(t,".hbs"),a=k.readFileSync(t,"utf-8");this.Handlebars.registerPartial(o,a+`
`)})};loadData=e=>{let t=this.utils.loadFiles(e).filter(o=>!o.includes("posts")).map(o=>({[J.basename(o,".json").replace(/-([a-z-0-9])/g,n=>n[1].toUpperCase())]:JSON.parse(k.readFileSync(o,"utf-8"))}));return Object.assign({},...t)};loadHelpers=()=>{this.Handlebars.registerHelper("ifand",I),this.Handlebars.registerHelper("ifequal",R)};loadPages=e=>{k.readdirSync(e).forEach(async s=>{let t=J.join(e,s);k.lstatSync(t).isDirectory()?this.loadPages(t):this.compileHbs(t)})};minifyHtml=e=>e.replace(/\s{2,}/g,"").replace(/\n/g,"").replace(/\t/g,"").replace(/<!--.*?-->/g,"");compileHbs=async e=>{let s=await this.loadData(this.options.data),t=k.readFileSync(e,"utf-8"),a={...{layout:this.utils.frontmatter(t).data.layout,title:this.utils.frontmatter(t).data.title,breadcrumb:this.utils.frontmatter(t).data.breadcrumb,asBlog:this.utils.frontmatter(t).data.asBlog,asSingle:this.utils.frontmatter(t).data.asSingle===void 0?!1:this.utils.frontmatter(t).data.asSingle,page:J.basename(e,".hbs"),path:e,root:e.split(J.sep).length>3?"../":"",body:this.utils.frontmatter(t).content},...s};this.Handlebars.registerHelper("ifpage",z(a.page)),this.Handlebars.registerHelper("unlessPage",q(a.page));let n=k.readFileSync(`./src/layouts/${a.layout}.hbs`,"utf-8");this.Handlebars.registerPartial("body",a.body+`
`);let r=a.path.split(J.sep),l=this.Handlebars.compile(n);if(r.length>3&&!k.existsSync(`./dist/${r[2]}`)&&k.mkdirSync(`./dist/${r[2]}`),a.asSingle){let c={...a,blog:JSON.parse(k.readFileSync(`./src/data/blog/posts/${a.page}.json`,"utf-8"))};c.blog.hidden===!1&&this.options.minify?k.writeFileSync(`./dist/${r[2]}/${c.page}.html`,this.minifyHtml(l(c))):c.blog.hidden===!1&&k.writeFileSync(`./dist/${r[2]}/${c.page}.html`,l(c).replace(/\t/g,""))}else this.options.minify?k.writeFileSync(`./dist/${a.page}.html`,this.minifyHtml(l(a))):k.writeFileSync(`./dist/${a.page}.html`,l(a).replace(/\t/g,""))};render=()=>{this.loadHelpers(),this.loadPartials(this.options.partials),this.loadPages(this.options.pages)}};var N=class{constructor(e){this.utils=new w,this.env=e}buildClean=()=>{[...this.utils.loadFiles("./dist",["blog","img"]),...this.utils.loadFiles("./dist/blog",["data"]),...this.utils.loadFiles("./dist/img",["user"])].forEach(s=>h.unlinkSync(s))};buildHtml=()=>{this.utils.logMessage("begin");let e=JSON.parse(h.readFileSync("./src/data/setting.json","utf-8")).optimization.minifyAssets.html;new P({pages:"./src/pages",layout:"./src/layout",partials:"./src/partials",data:"./src/data",minify:e}).render(),this.utils.logMessage("end","Html compiled successfully.")};buildCss=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/css");let e=H.compile("./src/assets/scss/main.scss",{logger:H.Logger.silent,style:"expanded"});h.writeFileSync("./dist/css/style.css",e.css),this.utils.logMessage("end","Css compiled successfully.")};buildJs=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/js"),this.utils.createDirectory("./dist/js/vendors"),this.utils.loadFiles("./src/assets/js",["utilities","vendors"]).forEach(o=>h.copyFileSync(o,`./dist/js/${x.basename(o)}`));let s=this.utils.loadFiles("./src/assets/js/utilities").map(o=>h.readFileSync(o,"utf-8"));W.transform(s.join(""),{root:"./node_modules/blockit-builder",minified:!0,comments:!1},(o,a)=>{h.writeFileSync("./dist/js/utilities.min.js",a.code)}),this.utils.loadFiles("./src/assets/js/vendors").forEach(o=>h.copyFileSync(o,`./dist/js/vendors/${x.basename(o)}`)),this.utils.logMessage("end","Js compiled successfully.")};buildImg=async()=>{this.utils.logMessage("begin"),this.utils.loadFiles("./src/assets/img",["blockit"]).forEach(e=>{this.utils.optimizeImg(e,"./dist/img")}),this.utils.loadFiles("./src/assets/img/blockit").forEach(e=>{this.utils.optimizeImg(e,"./dist/img/blockit")}),this.utils.logMessage("end","Images optimized successfully.")};buildStatic=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/fonts"),this.utils.loadFiles("./src/assets/fonts").forEach(t=>h.copyFileSync(t,`./dist/fonts/${x.basename(t)}`));let s=this.utils.loadFiles("./node_modules/@fortawesome/fontawesome-free/webfonts");s.filter(t=>t.includes("fa-brands-400")).forEach(t=>h.copyFileSync(t,`./dist/fonts/${x.basename(t)}`)),s.filter(t=>t.includes("fa-solid-900")).forEach(t=>h.copyFileSync(t,`./dist/fonts/${x.basename(t)}`)),h.copyFileSync("./src/assets/favicon/favicon.ico","./dist/img/favicon.ico"),h.copyFileSync("./src/assets/favicon/apple-touch-icon.png","./dist/img/apple-touch-icon.png"),h.copyFileSync("./src/assets/php/sendmail.php","./dist/sendmail.php"),process.env.npm_package_dependencies_bootstrap!==void 0&&(h.readFile("./node_modules/bootstrap/dist/js/bootstrap.bundle.min.js","utf-8",(t,o)=>{h.writeFileSync("./dist/js/vendors/bootstrap.bundle.min.js",o.replace("//# sourceMappingURL=bootstrap.bundle.min.js.map",""))}),h.copyFileSync("./node_modules/isotope-layout/dist/isotope.pkgd.min.js","./dist/js/vendors/isotope.min.js"),h.copyFileSync("./node_modules/bigger-picture/dist/bigger-picture.min.js","./dist/js/vendors/bigger-picture.min.js")),process.env.npm_package_dependencies_uikit!==void 0&&h.copyFileSync("./node_modules/uikit/dist/js/uikit.min.js","./dist/js/vendors/uikit.min.js"),this.utils.logMessage("end","Static assets delivered successfully.")};minifyCss=async()=>{this.utils.logMessage("begin");let e=H.compile("./src/assets/scss/main.scss",{logger:H.Logger.silent,style:"compressed"}).css,s=await new X().purge({content:["./dist/*.html","./dist/js/**/*.js"],css:[{raw:e}]});h.writeFileSync("./dist/css/style.css",s[0].css),this.utils.logMessage("end","Css minifying successfully.")};minifyJs=()=>{this.utils.logMessage("begin"),this.utils.loadFiles("./src/assets/js",["utilities","vendors"]).map(t=>({name:t,code:W.transformFileSync(t,{root:"./node_modules/blockit-builder",minified:!0,comments:!1}).code})).forEach(t=>h.writeFileSync(`./dist/js/${x.basename(t.name)}`,t.code)),this.utils.logMessage("end","Js minifying successfully.")};previewWatch=e=>{let s={ignoreInitial:!0};v.watch("./src/assets/scss/**/*.scss").on("change",this.utils.debounce(()=>{this.buildCss(),e.reload()})),v.watch("./src/assets/js/**/*.js").on("change",this.utils.debounce(()=>{this.buildJs(),e.reload()})),v.watch("./src/assets/img/**/*",s).on("all",this.utils.debounce(()=>{this.buildImg(),e.reload()})),v.watch(["./src/**/*.hbs","./src/data/**/*.json"],s).on("all",this.utils.debounce(()=>{this.buildHtml(),e.reload()})),v.watch(["./src/hooks/blog/search-post.hbs","./src/hooks/blog/search-result.hbs"]).on("change",()=>this.utils.hookSearch()),v.watch(["./src/hooks/sections/*.hbs","./src/hooks/sections/previews/*.webp"],s).on("unlink",t=>this.utils.hookSectionsRemove(t))};builderWatch=(e,s)=>{s==="DEV"&&v.watch(["./node_modules/blockit-builder/assets/app.js","./node_modules/blockit-builder/assets/app.css"]).on("change",this.utils.debounce(()=>e.reload()))}};import i from"fs";import{JSDOM as B}from"jsdom";import Y from"sharp";import Z from"svgo";var _=class{constructor(e){this.socket=e,this.utils=new w,this.compiler=new N}createDashboardData=()=>{let e={name:JSON.parse(i.readFileSync("./node_modules/blockit-builder/package.json","utf-8")).title,theme:process.env.npm_package_title,version:JSON.parse(i.readFileSync("./node_modules/blockit-builder/package.json","utf-8")).version,pages:i.readdirSync("./src/pages","utf8").filter(s=>s.match(/.(hbs)$/i)).filter(s=>!s.match(/blog-page/g)&&!s.match(/blog-find/g)).length,posts:i.readdirSync("./src/data/blog/posts","utf8").length,authors:JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).authors.length};this.socket.emit("dashboardData",e)};createPagesData=()=>{i.readdir("./src/pages",(e,s)=>{let t=s.filter(o=>o.match(/.(hbs)$/i)).filter(o=>!o.match(/blog-page/g)&&!o.match(/blog-find/g)).map(o=>({page:o.split(".").slice(0,-1).join("."),title:i.readFileSync(`./src/pages/${o}`,"utf8").match(/(?<=title:\s).*/g)[0],date:i.statSync(`./src/pages/${o}`).mtime,layout:i.readFileSync(`./src/pages/${o}`,"utf8").match(/(?<=layout:\s).*/g)[0],breadcrumb:i.readFileSync(`./src/pages/${o}`,"utf8").match(/(?<=breadcrumb:\s).*/g)[0],sections:i.readFileSync(`./src/pages/${o}`,"utf8").match(/{{>(.*?)}}*/g).map(a=>a.substring(4).slice(0,-3))}));this.socket.emit("pagesData",t)}),i.readFile("./src/data/setting.json","utf8",(e,s)=>{let t=JSON.parse(s).blog.asBlog===!1?!1:JSON.parse(s).blog.asBlog.split(".")[0];this.socket.emit("pagesCurrentBlog",t)})};createPagesActionData=()=>{let e=i.readdirSync("./src/hooks/sections","utf-8").filter(n=>n.match(/.(hbs)$/i)),s=this.utils.checkHook()&&e.length!==0?e:!1,t=s===!1?"empty":s[0].split("-")[1],o={name:`Exclusive - ${t.charAt(0).toUpperCase()+t.slice(1)}`,sections:s,icon:"ri-award-line"},a=[{name:"Card",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-card.json","utf-8")).map(n=>n.sectionName),icon:"ri-sticky-note-line"},{name:"Client logo",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-client-logo.json","utf-8")).map(n=>n.sectionName),icon:"ri-bubble-chart-line"},{name:"Contact",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-contact.json","utf-8")).map(n=>n.sectionName),icon:"ri-road-map-line"},{name:"Content",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-content.json","utf-8")).map(n=>n.sectionName),icon:"ri-file-text-line"},{name:"Counter",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-counter.json","utf-8")).map(n=>n.sectionName),icon:"ri-timer-line"},{name:"Faq",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-faq.json","utf-8")).map(n=>n.sectionName),icon:"ri-questionnaire-line"},{name:"Feature",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-feature.json","utf-8")).map(n=>n.sectionName),icon:"ri-stack-line"},{name:"Gallery",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-gallery.json","utf-8")).map(n=>n.sectionName),icon:"ri-gallery-line"},{name:"Pricing",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-pricing.json","utf-8")).map(n=>n.sectionName),icon:"ri-price-tag-3-line"},{name:"Slideshow",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/component-slideshow.json","utf-8")).map(n=>n.sectionName),icon:"ri-slideshow-2-line"},{name:"Team",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-team.json","utf-8")).map(n=>n.sectionName),icon:"ri-user-line"},{name:"Testimonial",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-testimonial.json","utf-8")).map(n=>n.sectionName),icon:"ri-chat-quote-line"},{name:"Timeline",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-timeline.json","utf-8")).map(n=>n.sectionName),icon:"ri-history-line"},{name:"Utility",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-utility.json","utf-8")).map(n=>n.sectionName),icon:"ri-tools-line"}];s!==!1&&a.splice(5,0,o),this.socket.emit("pagesActionData",a)};pagesDeletePage=(e,s)=>{i.readFile(`./src/pages/${e}.hbs`,"utf8",(t,o)=>{o.match(/(?<=asBlog:\s).*/g)[0]==="false"?(i.unlinkSync(`./dist/${e}.html`),i.unlinkSync(`./src/pages/${e}.hbs`),s!==void 0&&s.forEach(n=>!n.includes("component-slideshow")&&i.unlinkSync(`./src/partials/sections/${n}.hbs`))):(i.unlinkSync(`./dist/${e}.html`),i.unlinkSync(`./src/pages/${e}.hbs`),i.unlinkSync("./dist/blog-find.html"),i.unlinkSync("./src/pages/blog-find.hbs"),i.readdir("./src/pages",(n,r)=>{r.filter(l=>l.match(/.(hbs)$/i)).filter(l=>l.match(/blog-page/g)).forEach(l=>{i.unlinkSync(`./dist/${l.split(".").slice(0,-1)[0]}.html`),i.unlinkSync(`./src/pages/${l}`)})}),i.readFile("./src/data/setting.json","utf8",(n,r)=>{let l=JSON.parse(r);l.blog.asBlog=!1,i.writeFileSync("./src/data/setting.json",JSON.stringify(l,null,2)),this.socket.emit("pagesCurrentBlog",l.blog.asBlog)}),i.readFile("./src/assets/js/utilities/breadcrumb.js","utf8",(n,r)=>{let l=r.replace(/(?<=this\.blogPath\s=\s).*/g,!1);i.writeFileSync("./src/assets/js/utilities/breadcrumb.js",l)}),i.readFile("./src/assets/js/utilities/active-menu.js","utf8",(n,r)=>{let l=r.replace(/(?<=this\.blogPath\s=\s).*/g,!1);i.writeFileSync("./src/assets/js/utilities/active-menu.js",l)}))})};pagesSavePage=e=>{e.blogStatus?i.readFile("./src/data/setting.json","utf8",(s,t)=>{let o=JSON.parse(t);o.blog.asBlog=`${e.nameFile}.hbs`,i.writeFileSync("./src/data/setting.json",JSON.stringify(o,null,2)),i.readFile("./src/assets/js/utilities/breadcrumb.js","utf8",(n,r)=>{let l=r.replace(/(?<=this\.blogPath\s=\s).*/g,`'${e.nameFile}.html'`);i.writeFileSync("./src/assets/js/utilities/breadcrumb.js",l)}),i.readFile("./src/assets/js/utilities/active-menu.js","utf8",(n,r)=>{let l=r.replace(/(?<=this\.blogPath\s=\s).*/g,`'${e.nameFile}.html'`);i.writeFileSync("./src/assets/js/utilities/active-menu.js",l)}),this.changeBlogFrontmatter(e.data,"./src/hooks/blog/pages/blog.hbs","./node_modules/blockit-builder/hooks/blog/pages/blog.hbs"),this.changeBlogFrontmatter(e.data,"./src/hooks/blog/pages/blog-single.hbs","./node_modules/blockit-builder/hooks/blog/pages/blog-single.hbs"),this.changeBlogFrontmatter(e.data,"./src/hooks/blog/pages/blog-find.hbs","./node_modules/blockit-builder/hooks/blog/pages/blog-find.hbs"),i.readdir("./src/pages/blog",(n,r)=>{r.forEach(l=>this.changeBlogFrontmatter(e.data,`./src/pages/blog/${l}`))}),i.readFile("./src/data/blog/blog.json","utf8",(n,r)=>{let l=JSON.parse(r),c={defaultPage:i.existsSync("./src/hooks/blog/pages/blog.hbs")?i.readFileSync("./src/hooks/blog/pages/blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog.hbs","utf8"),singlePage:i.existsSync("./src/hooks/blog/pages/blog-single.hbs")?i.readFileSync("./src/hooks/blog/pages/blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog-single.hbs","utf8"),defaultSection:i.existsSync("./src/hooks/blog/sections/section-blog.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog.hbs","utf8"),singleSection:i.existsSync("./src/hooks/blog/sections/section-blog-single.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog-single.hbs","utf8")};this.postPaginatorPage(l,c)});let a=i.existsSync("./src/hooks/blog/pages/blog-find.hbs")?"./src/hooks/blog/pages/blog-find.hbs":"./node_modules/blockit-builder/hooks/blog/pages/blog-find.hbs";i.readFile(a,"utf8",(n,r)=>{let m=r.replace(/(?<=layout:\s).*/g,e.data.layout).replace(/(?<=title:\s).*/g,e.data.title).replace(/(?<=breadcrumb:\s).*/g,e.data.breadcrumb);i.writeFileSync("./src/pages/blog-find.hbs",m)})}):(i.writeFileSync(`./src/pages/${e.nameFile}.hbs`,e.data),e.currentBlog==="false"&&i.readFile("./src/data/setting.json","utf8",(s,t)=>{let o=JSON.parse(t);o.blog.asBlog=!1,i.writeFileSync("./src/data/setting.json",JSON.stringify(o,null,2))}))};readSectionData=e=>{let s=e.split("-").length>=4?`./src/partials/sections/${e}.hbs`:`./node_modules/blockit-builder/templates/${e.split("-").slice(0,-1).join("-")}.json`;i.readFile(s,"utf8",(t,o)=>{if(e.split("-").length>=4){let a={blocks:[{id:e,type:"code",data:{language:"HTML",text:o}}]};this.socket.emit("resultSectionData",a)}else{let a=JSON.parse(o).findIndex(r=>r.sectionName===e),n={blocks:[{id:e.split("-").length>=4?e:JSON.parse(o)[a].sectionName,type:"code",data:{language:"HTML",text:e.split("-").length>=4?o:JSON.parse(o)[a].sectionTag}}]};this.socket.emit("resultSectionData",n)}})};createSectionData=(e,s)=>{e.forEach(t=>{i.readFile(`./node_modules/blockit-builder/templates/${t.reference.split("-").slice(0,-1).join("-")}.json`,"utf8",(o,a)=>{JSON.parse(a).forEach(n=>{n.sectionName===t.reference&&!n.sectionName.includes("component-slideshow")&&(t.updateData==="new"?i.writeFileSync(`./src/partials/sections/${t.reference}-${t.id}.hbs`,n.sectionTag):t.updateData!==!1&&t.updateData!=="new"&&i.writeFileSync(`./src/partials/sections/${t.reference}-${t.id}.hbs`,t.updateData))})})}),(s.length!==0||s[0]!==!1)&&s.forEach(t=>{try{i.existsSync(`./src/partials/sections/${t}.hbs`)&&i.unlinkSync(`./src/partials/sections/${t}.hbs`)}catch(o){console.error(`file not found: ${o}`)}})};createPostsData=()=>{i.readdir("./src/data/blog/posts",(e,s)=>{let t=s.map(o=>{let a=JSON.parse(i.readFileSync(`./src/data/blog/posts/${o}`,"utf8"));return{title:a.title,link:a.link,dateCreated:a.dateCreated,dateModified:a.dateModified,timeCreated:a.timeCreated,timeModified:a.timeModified,author:a.author,category:a.category,hidden:a.hidden}});this.socket.emit("postsData",t)})};createPostsActionData=e=>{let s=JSON.parse(i.readFileSync("./src/data/setting.json","utf8")),t=e==="empty"?null:JSON.parse(i.readFileSync(`./src/data/blog/posts/${e}.json`,"utf8")),o={authors:{current:t===null?"":t.author.name,select:s.authors},categories:{current:t===null?"":t.category,select:s.blog.categories},currentTags:t===null?"":t.tags,currentImage:t===null?!1:t.image,title:t===null?"":t.title,dateCreated:t===null?"":t.dateCreated,timeCreated:t===null?"":t.timeCreated,blocks:t===null?"":t.blocks,hidden:t===null?"":t.hidden};this.socket.emit("postsActionData",o)};postPaginatorWidget=(e,s,t,o)=>{let a=s||1,n=t||10,r=(a-1)*n,l=e.slice(r).slice(0,t),c=Math.ceil(e.length/n);return{page:a,perPage:n,prevPage:a-1?a-1:null,nextPage:c>a?a+1:null,totalPost:e.length,totalPages:c,displayAuthor:o.blog.displayAuthor,data:l}};postPaginatorPage=(e,s)=>{let t=JSON.parse(i.readFileSync("./src/data/setting.json","utf8"));setTimeout(()=>{let o=t.blog.postPerPage,a=this.postPaginatorWidget(e.post,1,o,t),{totalPages:n}=a;if(t.blog.asBlog!==!1){let d=1;for(;d<=n;){let p=`blog-page-${d}`,D=this.postPaginatorWidget(e.post.filter(G=>!G.hidden),d,o,t);i.writeFileSync(`./src/data/blog/${p}.json`,JSON.stringify(D,null,2));let b=s.defaultPage.replace(/(?<={{> section-blog-)(.*?)(?= }})/g,d);d===1?i.writeFileSync(`./src/pages/${t.blog.asBlog}`,b):i.writeFileSync(`./src/pages/blog-page-${d}.hbs`,b);let C=s.defaultSection.replace(/{{#each(.*?).data}}/g,`{{#each blogPage${d}.data}}`).replace(/{{#if(.*?).displayAuthor}}/g,`{{#if @root.blogPage${d}.displayAuthor}}`);i.writeFileSync(`./src/partials/blog/section-blog-${d}.hbs`,C),d++}}i.readdir("./src/data/blog",(d,p)=>{let D=p.filter(C=>C.match(/(blog-page-)/g)),b=n+1,u=D.length;for(;b<=u;)i.existsSync(`./src/data/blog/blog-page-${b}.json`)&&i.unlinkSync(`./src/data/blog/blog-page-${b}.json`),i.existsSync(`./src/pages/blog-page-${b}.hbs`)&&i.unlinkSync(`./src/pages/blog-page-${b}.hbs`),i.existsSync(`./dist/blog-page-${b}.html`)&&i.unlinkSync(`./dist/blog-page-${b}.html`),b++}),i.readdir("./src/partials/blog",(d,p)=>{let D=p.filter(u=>u.match(/section-blog/g)).sort((u,C)=>u.length-C.length).filter((u,C)=>C<n);p.filter(u=>u.match(/section-blog/g)).filter(u=>!D.includes(u)).forEach(u=>{i.existsSync(`./src/partials/blog/${u}`)&&i.unlinkSync(`./src/partials/blog/${u}`)})});let r=e.post.filter(d=>!d.hidden).slice(0,3).map(d=>({title:d.title,link:d.link,date:d.dateCreated})),c=e.post.map(d=>d.tags).filter(d=>d).reduce((d,p)=>d.concat(p),[]).map(d=>d),m=c.filter((d,p)=>c.indexOf(d)===p),j=e.post.map(d=>d.category),f=j.filter((d,p)=>j.indexOf(d)===p),S={asBlog:t.blog.asBlog===!1?!1:`${t.blog.asBlog.split(".").slice(0,-1)}.html`,totalPages:n,tagLists:m,latestPost:r};i.writeFileSync("./dist/blog/data/data-blog.json",JSON.stringify(S)),i.readFile("./src/data/blog/blog.json","utf8",(d,p)=>{let D=JSON.parse(p),b=f.map(u=>this.createCategoryPost(D.post,u));i.writeFileSync("./dist/blog/data/data-category.json",JSON.stringify(b))}),i.readFile("./src/data/blog/blog.json","utf8",(d,p)=>{let D=JSON.parse(p),b=m.map(u=>this.createTagPost(D.post,u));b.forEach(u=>{u.posts.forEach(C=>{delete C.tags,delete C.blocks})}),i.writeFileSync("./dist/blog/data/data-tag.json",JSON.stringify(b))})},600)};createCategoryPost=(e,s)=>{let t=e.filter(o=>o.category===s);return t.forEach(o=>{o.content=this.utils.trimString(o.blocks[0].data.text),o.date=o.dateCreated,delete o.author.id,delete o.blocks,delete o.share,delete o.category,delete o.tags,delete o.dateCreated,delete o.timeCreated,o.image||delete o.image}),{category:s,totalPost:t.length,posts:t}};createTagPost=(e,s)=>{let t=[];return e.forEach(o=>{o.tags.forEach(a=>{a===s&&t.push(o)})}),t.forEach(o=>{o.content=this.utils.trimString(o.blocks[0].data.text),o.date=o.dateCreated===void 0?o.date:o.dateCreated,delete o.author.id,delete o.share,delete o.dateCreated,delete o.timeCreated,o.image||delete o.image}),{tag:s,totalPost:t.length,posts:t}};postCreatePage=e=>{i.readdir("./src/data/blog/posts",(s,t)=>{let o={post:t.map(a=>JSON.parse(i.readFileSync(`./src/data/blog/posts/${a}`,"utf8")))};o.post.sort((a,n)=>new Date(`${n.dateCreated} ${n.timeCreated}`)-new Date(`${a.dateCreated} ${a.timeCreated}`)),i.readFile("./src/data/blog/blog.json","utf-8",(a,n)=>{let r=JSON.parse(n).post.map(c=>(delete c.dateModified,delete c.timeModified,c)),l=o.post.map(c=>(delete c.dateModified,delete c.timeModified,c));if(JSON.stringify(r)!==JSON.stringify(l)){let c={post:o.post.filter(m=>!m.hidden)};i.writeFileSync("./src/data/blog/blog.json",JSON.stringify(c,null,2))}}),this.postPaginatorPage(o,e)})};postsSaveContent=async(e,s,t)=>{i.unlink("./dist/blog/*.html",()=>{let o=t.singlePage.replace(/(?<={{> post-title)(.*?)(?= }})/g,`-${e}`);i.writeFileSync(`./src/data/blog/posts/${e}.json`,JSON.stringify(s,null,2)),s.hidden&&i.existsSync(`./dist/blog/${s.link}`)&&i.unlinkSync(`./dist/blog/${s.link}`),s.hidden===!1&&(i.writeFileSync(`./src/partials/blog/post-title-${e}.hbs`,t.singleSection),i.writeFileSync(`./src/pages/blog/${e}.hbs`,o)),this.postCreatePage(t)})};postsDeletePost=(e,s)=>{let t=[`./src/data/blog/posts/${e}.json`,`./src/pages/blog/${e}.hbs`,`./src/partials/blog/post-title-${e}.hbs`,`./dist/blog/${e}.html`];return Promise.all(t.map(o=>i.unlinkSync(o))).then(this.socket.emit("deleteDone","success"),this.postCreatePage(s))};createEditorData=e=>{i.readFile(`./src/data/blog/posts/${e}.json`,"utf8",(s,t)=>this.socket.emit("editorData",t))};postsTagSources=()=>{let e={defaultPage:i.existsSync("./src/hooks/blog/pages/blog.hbs")?i.readFileSync("./src/hooks/blog/pages/blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog.hbs","utf8"),singlePage:i.existsSync("./src/hooks/blog/pages/blog-single.hbs")?i.readFileSync("./src/hooks/blog/pages/blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog-single.hbs","utf8"),defaultSection:i.existsSync("./src/hooks/blog/sections/section-blog.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog.hbs","utf8"),singleSection:i.existsSync("./src/hooks/blog/sections/section-blog-single.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog-single.hbs","utf8")};this.socket.emit("tagSourcesData",e)};findBlogTitle=(e,s,t)=>{if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]===t)return e;for(let o of Object.keys(e))if(typeof e[o]=="object"){let a=this.findBlogTitle(e[o],s,t);if(a!==null&&typeof a<"u")return a}return null};createBlogTitle=e=>{if(this.findBlogTitle(e,"link","blog/page-1.html")!==null){let s=this.findBlogTitle(e,"link","blog/page-1.html").title;i.readdir("./src/pages/blog",(t,o)=>{o.forEach(a=>{i.readFile(`./src/pages/blog/${a}`,"utf8",(n,r)=>{let c=r.replace(/(?<=data-title=")([^"]*)/g,s.toLowerCase()).replace(/(?<=title:\s).*/g,s);i.writeFileSync(`./src/pages/blog/${a}`,c)})})})}};changeBlogFrontmatter=(e,s,t)=>{let r=(i.existsSync(s)?i.readFileSync(s,"utf8"):i.readFileSync(t,"utf8")).replace(/(?<=layout:\s).*/g,e.layout).replace(/(?<=title:\s).*/g,e.title).replace(/(?<=breadcrumb:\s).*/g,e.breadcrumb);i.existsSync(s)?i.writeFileSync(s,r):i.writeFileSync(t,r)};createNavigationData=()=>{let e={nav:JSON.parse(i.readFileSync("./src/data/navigation.json","utf8")),select:i.readdirSync("./src/pages","utf8").filter(s=>!s.match(/blog-page/g)&&!s.match(/blog-find/g)).filter(s=>s.match(/.(hbs)$/i))};this.socket.emit("navigationData",e)};saveNavigationData=e=>{i.writeFileSync("./src/data/navigation.json",JSON.stringify(e,null,2)),this.createBlogTitle(e)};assetsUpload=(e,s,t)=>{let o={};if(s.includes("author")?Object.assign(o,{width:72,height:72}):s.includes("featured")?Object.assign(o,{width:1130}):s.includes("post")?Object.assign(o,{width:980}):Object.assign(o,{width:null}),t==="svg"){let a=Z.optimize;i.writeFileSync(`./dist/img/user/${s}`,a(e).data),this.socket.emit("uploadDone",`img/user/${s}`)}else Y(e).resize(o).toFile(`./dist/img/user/${s}`,a=>{if(a)throw a;this.socket.emit("uploadDone",`img/user/${s}`)})};assetsDelete=e=>{i.existsSync(`./dist/img/user/${e}`)&&i.unlink(`./dist/img/user/${e}`,s=>{if(s)throw s;this.socket.emit("deleteDone","success")})};saveSettingsData=(e,s)=>{i.readFile("./src/assets/scss/_colors.scss","utf8",(t,o)=>{let a=o,p=a.replace(/(?<=primary:\s)([^;]*)/g,e.colors.primaryColor).replace(/(?<=secondary:\s)([^;]*)/g,e.colors.secondaryColor).replace(/(?<=success:\s)([^;]*)/g,e.colors.successColor).replace(/(?<=info:\s)([^;]*)/g,e.colors.infoColor).replace(/(?<=warning:\s)([^;]*)/g,e.colors.warningColor).replace(/(?<=danger:\s)([^;]*)/g,e.colors.dangerColor).replace(/(?<=light:\s)([^;]*)/g,e.colors.lightColor).replace(/(?<=dark:\s)([^;]*)/g,e.colors.darkColor).replace(/(?<=body-bg:\s)([^;]*)/g,e.colors.backgroundColor).replace(/(?<=body-color:\s)([^;]*)/g,e.colors.textColor).replace(/(?<=link-color:\s)([^;]*)/g,e.colors.linkColor);a!==p&&i.writeFileSync("./src/assets/scss/_colors.scss",p)}),i.readFile("./src/data/setting.json","utf-8",(t,o)=>{o!==JSON.stringify(e,null,2)&&i.writeFileSync("./src/data/setting.json",JSON.stringify(e,null,2)),this.postCreatePage(s),this.updateAuthorData(o,e,s),this.runMinifying(o,e)})};runMinifying=(e,s)=>{let t=s.optimization.minifyAssets.css,o=s.optimization.minifyAssets.js,a=JSON.parse(e).optimization.minifyAssets.css!==t,n=JSON.parse(e).optimization.minifyAssets.js!==o;a&&t?this.compiler.minifyCss():a&&!t&&this.compiler.buildCss(),n&&o?this.compiler.minifyJs():n&&!o&&this.compiler.buildJs()};saveEmail=e=>{i.readFile("./dist/sendmail.php","utf8",(s,t)=>{if(String(t.match(/(?<=emailTo = ).*/g))!==`"${e}";`){let a=t.replace(/(?<=emailTo = ).*/g,`"${e}";`);i.writeFileSync("./dist/sendmail.php",a)}})};saveMap=e=>{i.readdir("./src/partials/sections",(s,t)=>{t.filter(a=>a.match(/section-contact/g)).forEach(a=>{i.readFile(`./src/partials/sections/${a}`,"utf8",(n,r)=>{let l=r.split(`
`)[0],c=new B(r),m=c.window.document.querySelector("iframe");if(m!==null){m.src=e;let j=l.concat(`
`,c.window.document.documentElement.childNodes[1].innerHTML);i.writeFileSync(`./src/partials/sections/${a}`,j)}})})})};saveSocialMedia=()=>{let s=JSON.parse(i.readFileSync("src/data/component.json","utf8")).socialMedia.filter(t=>Object.values(t)[0].length!==0).map(t=>{let o=Object.keys(t)[0];return`	<div><a href="${Object.values(t)[0]}" class="color-${o} text-decoration-none"><i class="fab fa-${o==="facebook"?"facebook-square":o}"></i> ${o.charAt(0).toUpperCase()+o.slice(1)}</a></div>`}).join(`
`);i.readFile("src/partials/components/component-social-media.hbs","utf8",(t,o)=>{let a=o.split(`
`)[0],n=new B(o),r=n.window.document.querySelector(".social-media-list")===null?!1:n.window.document.querySelector(".social-media-list");r&&(r.innerHTML=`
${s}
`);let l=a.concat(`
`,n.window.document.documentElement.childNodes[1].innerHTML);i.writeFileSync("src/partials/components/component-social-media.hbs",l)})};saveFooter=()=>{let e=JSON.parse(i.readFileSync("./src/data/component.json","utf8")).footer;i.readFile("./src/partials/components/component-footer.hbs","utf8",(s,t)=>{let o=t.split(`
`)[0],a=new B(t),{logoIndex:n,showClass:r,hideClass:l,logoClass:c,copyrightClass:m}=e.hooks,j=a.window.document.querySelector(`.${m}`),f=a.window.document.querySelector(`.${c}`)===null?!1:a.window.document.querySelector(`.${c}`);e.siteLogo.exist&&(e.siteLogo.enabled?(f.children[n].classList.add(r),f.children[n].classList.remove(l),f.children[n].setAttribute("src",`{{root}}${e.siteLogo.logo.src}`),f.children[n].setAttribute("width",e.siteLogo.logo.width),f.children[n].setAttribute("height",e.siteLogo.logo.height)):(f.children[n].classList.add(l),f.children[n].classList.remove(r))),j.innerHTML=e.copyrightText;let F=a.window.document.documentElement.childNodes[1].innerHTML.replace(/&gt;/g,">"),S=o.concat(`
`,F);i.writeFileSync("./src/partials/components/component-footer.hbs",S)})};saveSlideshow=e=>{let s=i.readFileSync("./node_modules/blockit-builder/hooks/slideshow/slideshow-wrapper.hbs","utf8");i.existsSync("./src/hooks/slideshow/slideshow-wrapper.hbs")&&(s=i.readFileSync("./src/hooks/slideshow/slideshow-wrapper.hbs","utf8"));let t=[{sectionName:"component-slideshow-1",slides:e[0].slides},{sectionName:"component-slideshow-2",slides:e[1].slides},{sectionName:"component-slideshow-3",slides:e[2].slides},{sectionName:"component-slideshow-4",slides:e[3].slides}],o=t.filter(n=>n.slides.length!==0),a=t.filter(n=>!o.includes(n)).map(n=>n.sectionName);e.forEach((n,r)=>{if(n.slides.length!==0){let l=n.slides.map(m=>m.text),c=s.replace(/\{{(.*slide-id)\}}/g,l.join(" "));i.writeFileSync("./node_modules/blockit-builder/templates/component-slideshow.json",JSON.stringify(o,null,4)),i.writeFileSync(`./src/partials/components/component-slideshow-${r+1}.hbs`,c)}}),a.forEach(n=>{i.existsSync(`./src/partials/components/${n}.hbs`)&&i.unlinkSync(`./src/partials/components/${n}.hbs`)})};createSettingsData=()=>{i.readFile("./src/data/setting.json","utf8",(e,s)=>this.socket.emit("settingsData",JSON.parse(s)))};createFooterData=()=>{i.readFile("./src/partials/components/component-footer.hbs","utf8",(e,s)=>{let t={blocks:[{id:"footer-content",type:"code",data:{language:"HTML",text:s}}]};this.socket.emit("footerData",t)})};saveFooterEditor=e=>{Object.keys(e).length!==0&&i.writeFileSync("./src/partials/components/component-footer.hbs",e)};createSlideItem=e=>{i.existsSync("./src/hooks/slideshow/slideshow-item.hbs")?this.createSlideData("./src/hooks/slideshow/slideshow-item.hbs",e):this.createSlideData("./node_modules/blockit-builder/hooks/slideshow/slideshow-item.hbs",e)};createSlideData=(e,s)=>{i.readFile(e,"utf8",(t,o)=>{let a={blocks:[{id:s,type:"code",data:{language:"HTML",text:o}}]};this.socket.emit("slideItem",a)})};createComponentsData=()=>{i.readFile("./src/data/component.json","utf8",(e,s)=>this.socket.emit("componentsData",JSON.parse(s)))};updateAuthorData=(e,s,t)=>{let o=JSON.parse(e).authors,a=s.authors,n=o.filter(this.utils.compareObj(a)),r=a.filter(this.utils.compareObj(o)),l=n.concat(r),c={post:[]};i.readdir("./src/data/blog/posts",(m,j)=>{j.forEach(f=>{let F=JSON.parse(i.readFileSync(`./src/data/blog/posts/${f}`,"utf8"));l.length!==0&&(Object.values(F).forEach(S=>{(S.id===l[0].id&&S.name!==l[1].name||S.id===l[0].id&&S.avatar!==l[1].avatar)&&(S.name=l[1].name,S.avatar=l[1].avatar)}),i.writeFileSync(`./src/data/blog/posts/${f}`,JSON.stringify(F,null,2))),c.post.push(F)}),c.post.sort((f,F)=>new Date(`${F.dateCreated} ${F.timeCreated}`)-new Date(`${f.dateCreated} ${f.timeCreated}`)),i.writeFileSync("./src/data/blog/blog.json",JSON.stringify(c,null,2)),this.postPaginatorPage(c,t)})};saveComponentsData=e=>{i.writeFileSync("./src/data/component.json",JSON.stringify(e,null,2)),this.saveEmail(e.contactMap.email),this.saveMap(e.contactMap.mapSrc),this.saveSlideshow(e.slideshow),this.saveFooter(),this.saveSocialMedia()}};var E=class{constructor(e){this.blockit=e}dashboardSocket=e=>{e.on("getDashboardData",()=>this.blockit.createDashboardData())};pagesSocket=e=>{e.on("getPagesData",()=>this.blockit.createPagesData()),e.on("getPagesActionData",()=>this.blockit.createPagesActionData()),e.on("deletePageData",(s,t)=>this.blockit.pagesDeletePage(s,t)),e.on("savePageActionData",s=>this.blockit.pagesSavePage(s)),e.on("readSectionData",s=>this.blockit.readSectionData(s)),e.on("saveSectionData",(s,t)=>this.blockit.createSectionData(s,t))};navigationSocket=e=>{e.on("getNavigationData",()=>this.blockit.createNavigationData()),e.on("saveNavigation",s=>this.blockit.saveNavigationData(s))};postsSocket=e=>{e.on("getPostsData",()=>this.blockit.createPostsData()),e.on("deletePostData",(s,t)=>this.blockit.postsDeletePost(s,t)),e.on("getPostsActionData",s=>this.blockit.createPostsActionData(s)),e.on("savePostContent",(s,t,o)=>this.blockit.postsSaveContent(s,t,o)),e.on("getEditorData",s=>this.blockit.createEditorData(s)),e.on("triggerTagSources",()=>this.blockit.postsTagSources())};componentsSocket=e=>{e.on("getComponentsData",()=>this.blockit.createComponentsData()),e.on("saveComponents",s=>this.blockit.saveComponentsData(s)),e.on("getSlideItem",s=>this.blockit.createSlideItem(s))};settingsSocket=e=>{e.on("getSettingsData",()=>this.blockit.createSettingsData()),e.on("getFooterData",()=>this.blockit.createFooterData()),e.on("saveFooterEditor",s=>this.blockit.saveFooterEditor(s)),e.on("saveSettingsData",(s,t)=>this.blockit.saveSettingsData(s,t)),e.on("assetsUpload",(s,t,o)=>this.blockit.assetsUpload(s,t,o)),e.on("assetsDelete",s=>this.blockit.assetsDelete(s))}};import U from"browser-sync";var M=class{constructor(e,s){this.preview=U.create(),this.builder=U.create(),this.compiler=e,this.env=s}run=()=>{this.preview.init({port:3e3,ui:!1,notify:!1,open:!1,server:"./dist",callbacks:{ready:(e,s)=>{s.addMiddleware("*",(t,o)=>{o.writeHead(302,{location:"/404.html"}),o.end("Redirecting!")}),this.compiler.previewWatch(this.preview)}}}),this.builder.init({port:3001,ui:!1,notify:!1,server:"./node_modules/blockit-builder",single:!0,snippetOptions:{async:!1},logLevel:"silent",callbacks:{ready:(e,s)=>{s.io.sockets.on("connection",t=>{let o=new _(t),a=new E(o);a.dashboardSocket(t),a.pagesSocket(t),a.navigationSocket(t),a.postsSocket(t),a.componentsSocket(t),a.settingsSocket(t)}),this.compiler.builderWatch(this.builder,this.env)}}})}};var V="DEV",O=new N(V),ee=new M(O,V),A=new w,se=async()=>{A.logHeading(),O.buildClean(),O.buildHtml(),O.buildCss(),O.buildJs(),await O.buildImg(),O.buildStatic(),A.logMessage("completed")},te=()=>{A.logHeading(),A.hookSections(),ee.run()},oe=()=>process.argv.includes("--build")?se():te();oe();
