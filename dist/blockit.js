import b from"fs";import $ from"path";import _ from"sass";import A from"@babel/core";import v from"chokidar";import S from"fs";import N from"path";import X from"handlebars";import g from"fs";import R from"js-yaml";import w from"path";import E from"sharp";import Q from"svgo";import i from"fs";import{JSDOM as H}from"jsdom";import G from"sharp";import K from"svgo";var C=class{constructor(e){this.socket=e,this.utils=new F,this.compiler=new j}createDashboardData=()=>{let e=JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[0]===!1?JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[1]:JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[0],o=new RegExp(`${e}-page`),s=new RegExp(`${e}-find`),t={name:JSON.parse(i.readFileSync("./node_modules/blockit-builder/package.json","utf-8")).title,theme:process.env.npm_package_title,version:JSON.parse(i.readFileSync("./node_modules/blockit-builder/package.json","utf-8")).version,pages:i.readdirSync("./src/pages","utf8").filter(a=>a.match(/.(hbs)$/i)).filter(a=>!a.match(o)&&!a.match(s)).length,posts:i.readdirSync("./src/data/blog/posts","utf8").length,authors:JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).authors.length};this.socket.emit("dashboardData",t)};createPagesData=()=>{let e=JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[0]===!1?JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[1]:JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[0],o=new RegExp(`${e}-page`),s=new RegExp(`${e}-find`);i.readdir("./src/pages",(t,a)=>{let n=a.filter(l=>l.match(/.(hbs)$/i)).filter(l=>!l.match(o)&&!l.match(s)).map(l=>({page:l.split(".").slice(0,-1).join("."),title:i.readFileSync(`./src/pages/${l}`,"utf8").match(/(?<=title:\s).*/g)[0],date:i.statSync(`./src/pages/${l}`).mtime,layout:i.readFileSync(`./src/pages/${l}`,"utf8").match(/(?<=layout:\s).*/g)[0],breadcrumb:i.readFileSync(`./src/pages/${l}`,"utf8").match(/(?<=breadcrumb:\s).*/g)[0],sections:i.readFileSync(`./src/pages/${l}`,"utf8").match(/{{>(.*?)}}*/g).map(r=>r.substring(4).slice(0,-3))}));this.socket.emit("pagesData",n)}),i.readFile("./src/data/setting.json","utf8",(t,a)=>{let n=JSON.parse(a).blog.asBlog[0]===!1?!1:JSON.parse(a).blog.asBlog[0];this.socket.emit("pagesCurrentBlog",n)})};createPagesActionData=()=>{let e=process.env.npm_package_title.toLowerCase(),o=i.readdirSync("./src/hooks/sections","utf-8").filter(a=>a.includes(e)).sort((a,n)=>a.length-n.length),s={name:`Exclusive - ${e.charAt(0).toUpperCase()+e.slice(1)}`,sections:o,icon:"ri-award-line"},t=[{name:"Card",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-card.json","utf-8")).map(a=>a.sectionName),icon:"ri-sticky-note-line"},{name:"Client logo",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-client-logo.json","utf-8")).map(a=>a.sectionName),icon:"ri-bubble-chart-line"},{name:"Contact",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-contact.json","utf-8")).map(a=>a.sectionName),icon:"ri-road-map-line"},{name:"Content",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-content.json","utf-8")).map(a=>a.sectionName),icon:"ri-file-text-line"},{name:"Counter",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-counter.json","utf-8")).map(a=>a.sectionName),icon:"ri-timer-line"},{name:"Faq",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-faq.json","utf-8")).map(a=>a.sectionName),icon:"ri-questionnaire-line"},{name:"Feature",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-feature.json","utf-8")).map(a=>a.sectionName),icon:"ri-stack-line"},{name:"Gallery",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-gallery.json","utf-8")).map(a=>a.sectionName),icon:"ri-gallery-line"},{name:"Pricing",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-pricing.json","utf-8")).map(a=>a.sectionName),icon:"ri-price-tag-3-line"},{name:"Slideshow",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/component-slideshow.json","utf-8")).map(a=>a.sectionName),icon:"ri-slideshow-2-line"},{name:"Team",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-team.json","utf-8")).map(a=>a.sectionName),icon:"ri-user-line"},{name:"Testimonial",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-testimonial.json","utf-8")).map(a=>a.sectionName),icon:"ri-chat-quote-line"},{name:"Timeline",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-timeline.json","utf-8")).map(a=>a.sectionName),icon:"ri-history-line"},{name:"Utility",sections:JSON.parse(i.readFileSync("./node_modules/blockit-builder/templates/section-utility.json","utf-8")).map(a=>a.sectionName),icon:"ri-tools-line"}];o.length!==0&&t.splice(5,0,s),this.socket.emit("pagesActionData",t)};pagesDeletePage=(e,o)=>{i.readFile(`./src/pages/${e}.hbs`,"utf8",(s,t)=>{if(t.match(/(?<=asBlog:\s).*/g)[0]==="false")i.unlinkSync(`./dist/${e}.html`),i.unlinkSync(`./src/pages/${e}.hbs`),o!==void 0&&o.forEach(n=>!n.includes("component-slideshow")&&i.unlinkSync(`./src/partials/sections/${n}.hbs`));else{let n=JSON.parse(i.readFileSync("./src/data/setting.json","utf-8")).blog.asBlog[0],l=new RegExp(`${n}-page`);i.unlinkSync(`./dist/${e}.html`),i.unlinkSync(`./src/pages/${e}.hbs`),i.unlinkSync(`./dist/${n}-find.html`),i.unlinkSync(`./src/pages/${n}-find.hbs`),i.readdir("./src/pages",(r,c)=>{c.filter(d=>d.match(/.(hbs)$/i)).filter(d=>d.match(l)).forEach(d=>{i.unlinkSync(`./dist/${d.split(".").slice(0,-1)[0]}.html`),i.unlinkSync(`./src/pages/${d}`)})}),this.unsetBlogPage(),i.readFile("./src/assets/js/utilities/breadcrumb.js","utf8",(r,c)=>{let d=c.replace(/(?<=this\.blogPath\s=\s).*/g,!1);i.writeFileSync("./src/assets/js/utilities/breadcrumb.js",d)}),i.readFile("./src/assets/js/utilities/active-menu.js","utf8",(r,c)=>{let d=c.replace(/(?<=this\.blogPath\s=\s).*/g,!1);i.writeFileSync("./src/assets/js/utilities/active-menu.js",d)})}})};pagesSavePage=e=>{e.blogStatus?i.readFile("./src/data/setting.json","utf8",(o,s)=>{let t=JSON.parse(s);t.blog.asBlog[0]=`${e.nameFile}`,i.writeFileSync("./src/data/setting.json",JSON.stringify(t,null,2)),t.blog.asBlog[0]!==!1&&(this.utils.createDirectory(`./src/pages/${t.blog.asBlog[0]}`),this.utils.createDirectory(`./dist/${t.blog.asBlog[0]}`),this.utils.createDirectory(`./dist/${t.blog.asBlog[0]}/data`),i.readdir("./src/data/blog/posts",(n,l)=>{let r=i.existsSync("./src/hooks/blog/pages/blog-single.hbs")?i.readFileSync("./src/hooks/blog/pages/blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog-single.hbs","utf8");l.forEach(c=>{let d=c.split(".")[0],u=r.replace(/(?<={{> post-title)(.*?)(?= }})/g,`-${d}`);i.writeFileSync(`./src/pages/${t.blog.asBlog[0]}/${d}.hbs`,u)})})),i.readFile("./src/assets/js/utilities/breadcrumb.js","utf8",(n,l)=>{let r=l.replace(/(?<=this\.blogPath\s=\s).*/g,`'${e.nameFile}.html'`);i.writeFileSync("./src/assets/js/utilities/breadcrumb.js",r)}),i.readFile("./src/assets/js/utilities/active-menu.js","utf8",(n,l)=>{let r=l.replace(/(?<=this\.blogPath\s=\s).*/g,`'${e.nameFile}.html'`);i.writeFileSync("./src/assets/js/utilities/active-menu.js",r)}),this.changeBlogFrontmatter(e.data,"./src/hooks/blog/pages/blog.hbs","./node_modules/blockit-builder/hooks/blog/pages/blog.hbs"),this.changeBlogFrontmatter(e.data,"./src/hooks/blog/pages/blog-single.hbs","./node_modules/blockit-builder/hooks/blog/pages/blog-single.hbs"),this.changeBlogFrontmatter(e.data,"./src/hooks/blog/pages/blog-find.hbs","./node_modules/blockit-builder/hooks/blog/pages/blog-find.hbs"),i.readdir(`./src/pages/${e.nameFile}`,(n,l)=>{l.forEach(r=>this.changeBlogFrontmatter(e.data,`./src/pages/${e.nameFile}/${r}`))}),i.readFile("./src/data/blog/blog.json","utf8",(n,l)=>{let r=JSON.parse(l),c={defaultPage:i.existsSync("./src/hooks/blog/pages/blog.hbs")?i.readFileSync("./src/hooks/blog/pages/blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog.hbs","utf8"),singlePage:i.existsSync("./src/hooks/blog/pages/blog-single.hbs")?i.readFileSync("./src/hooks/blog/pages/blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog-single.hbs","utf8"),defaultSection:i.existsSync("./src/hooks/blog/sections/section-blog.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog.hbs","utf8"),singleSection:i.existsSync("./src/hooks/blog/sections/section-blog-single.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog-single.hbs","utf8")};this.postPaginatorPage(r,c)});let a=i.existsSync("./src/hooks/blog/pages/blog-find.hbs")?"./src/hooks/blog/pages/blog-find.hbs":"./node_modules/blockit-builder/hooks/blog/pages/blog-find.hbs";i.readFile(a,"utf8",(n,l)=>{let d=l.replace(/(?<=layout:\s).*/g,e.data.layout).replace(/(?<=title:\s).*/g,e.data.title).replace(/(?<=breadcrumb:\s).*/g,e.data.breadcrumb);i.writeFileSync(`./src/pages/${e.nameFile}-find.hbs`,d)})}):(i.writeFileSync(`./src/pages/${e.nameFile}.hbs`,e.data),e.currentBlog==="false"&&this.unsetBlogPage())};unsetBlogPage=()=>{i.readFile("./src/data/setting.json","utf8",(e,o)=>{let s=JSON.parse(o);s.blog.asBlog.unshift(!1),s.blog.asBlog.pop(),i.writeFileSync("./src/data/setting.json",JSON.stringify(s,null,2)),i.existsSync(`./src/pages/${s.blog.asBlog[1]}-find.hbs`)&&(i.unlinkSync(`./src/pages/${s.blog.asBlog[1]}-find.hbs`),i.unlinkSync(`./dist/${s.blog.asBlog[1]}-find.html`)),s.blog.asBlog[0]===!1&&(i.rmdirSync(`./src/pages/${s.blog.asBlog[1]}`,{recursive:!0}),i.rmdirSync(`./dist/${s.blog.asBlog[1]}`,{recursive:!0}));let t=new RegExp(`${s.blog.asBlog[1]}-page`);i.readdirSync("./src/pages","utf8").filter(a=>a.match(/.(hbs)$/i)).filter(a=>a.match(t)).forEach(a=>{i.unlinkSync(`./src/pages/${a}`),i.unlinkSync(`./dist/${a.split(".")[0]}.html`)}),this.socket.emit("pagesCurrentBlog",s.blog.asBlog[0])})};readSectionData=e=>{let o=`./node_modules/blockit-builder/templates/${e.split("-").slice(0,-1).join("-")}.json`;i.readFile(o,"utf8",(s,t)=>{let a=JSON.parse(t).findIndex(l=>l.sectionName===e),n={blocks:[{type:"code",data:{language:"HTML",text:JSON.parse(t)[a].sectionTag}}]};this.socket.emit("resultSectionData",n)})};readSectionsEdit=e=>{let s=e.filter(t=>!t.includes("component")&&!t.includes("section-blog")).map(t=>({name:t,data:{blocks:[{type:"code",data:{language:"HTML",text:i.readFileSync(`./src/partials/sections/${t}.hbs`,"utf-8")}}]}}));this.socket.emit("resultSectionsEdit",s)};createSectionData=(e,o)=>{e.filter(s=>s.data!==!1).forEach(s=>{i.writeFileSync(`./src/partials/sections/${s.name}.hbs`,s.data)}),(o.length!==0||o[0]!==!1)&&o.forEach(s=>{try{i.existsSync(`./src/partials/sections/${s}.hbs`)&&i.unlinkSync(`./src/partials/sections/${s}.hbs`)}catch(t){console.error(`file not found: ${t}`)}})};createPostsData=()=>{i.readdir("./src/data/blog/posts",(e,o)=>{let s=o.map(t=>{let a=JSON.parse(i.readFileSync(`./src/data/blog/posts/${t}`,"utf8"));return{title:a.title,link:a.link,dateCreated:a.dateCreated,dateModified:a.dateModified,timeCreated:a.timeCreated,timeModified:a.timeModified,author:a.author,category:a.category,hidden:a.hidden}});this.socket.emit("postsData",s)})};createPostsActionData=e=>{let o=JSON.parse(i.readFileSync("./src/data/setting.json","utf8")),s=e==="empty"?null:JSON.parse(i.readFileSync(`./src/data/blog/posts/${e}.json`,"utf8")),t={asBlog:o.blog.asBlog[0],authors:{current:s===null?"":s.author.name,select:o.authors},categories:{current:s===null?"":s.category,select:o.blog.categories},currentTags:s===null?"":s.tags,currentImage:s===null?!1:s.image,title:s===null?"":s.title,dateCreated:s===null?"":s.dateCreated,timeCreated:s===null?"":s.timeCreated,blocks:s===null?"":s.blocks,hidden:s===null?"":s.hidden};this.socket.emit("postsActionData",t)};postPaginatorWidget=(e,o,s,t)=>{let a=o||1,n=s||10,l=(a-1)*n,r=e.slice(l).slice(0,s),c=Math.ceil(e.length/n);return{asBlog:t.blog.asBlog[0],page:a,perPage:n,prevPage:a-1?a-1:null,nextPage:c>a?a+1:null,totalPost:e.length,totalPages:c,displayAuthor:t.blog.displayAuthor,data:r}};postPaginatorPage=(e,o)=>{let s=JSON.parse(i.readFileSync("./src/data/setting.json","utf8"));setTimeout(()=>{let t=s.blog.postPerPage,a=this.postPaginatorWidget(e.post,1,t,s),{totalPages:n}=a;if(s.blog.asBlog[0]!==!1){let l=1;for(;l<=n;){let r=`blog-page-${l}`,c=this.postPaginatorWidget(e.post.filter(p=>!p.hidden),l,t,s);i.writeFileSync(`./src/data/blog/${r}.json`,JSON.stringify(c,null,2));let d=o.defaultPage.replace(/(?<={{> section-blog-)(.*?)(?= }})/g,l);l===1?i.writeFileSync(`./src/pages/${s.blog.asBlog[0]}.hbs`,d):i.writeFileSync(`./src/pages/${s.blog.asBlog[0]}-page-${l}.hbs`,d);let k=o.defaultSection.replace(/{{#each(.*?).data}}/g,`{{#each blogPage${l}.data}}`).replace(/{{#if(.*?).displayAuthor}}/g,`{{#if @root.blogPage${l}.displayAuthor}}`).replace(/{{@root(.*?).asBlog}}/g,`{{@root.blogPage${l}.asBlog}}`);i.writeFileSync(`./src/partials/blog/section-blog-${l}.hbs`,k),l++}}if(i.readdir("./src/data/blog",(l,r)=>{let c=r.filter(m=>m.match(/(blog-page-)/g)),d=n+1,u=c.length;for(;d<=u;)i.existsSync(`./src/data/blog/blog-page-${d}.json`)&&i.unlinkSync(`./src/data/blog/blog-page-${d}.json`),i.existsSync(`./src/pages/${s.blog.asBlog[0]}-page-${d}.hbs`)&&i.unlinkSync(`./src/pages/${s.blog.asBlog[0]}-page-${d}.hbs`),i.existsSync(`./dist/${s.blog.asBlog[0]}-page-${d}.html`)&&i.unlinkSync(`./dist/${s.blog.asBlog[0]}-page-${d}.html`),d++}),i.readdir("./src/partials/blog",(l,r)=>{let c=r.filter(u=>u.match(/section-blog/g)).sort((u,m)=>u.length-m.length).filter((u,m)=>m<n);r.filter(u=>u.match(/section-blog/g)).filter(u=>!c.includes(u)).forEach(u=>{i.existsSync(`./src/partials/blog/${u}`)&&i.unlinkSync(`./src/partials/blog/${u}`)})}),s.blog.asBlog[0]!==!1){this.utils.createDirectory(`./dist/${s.blog.asBlog[0]}/data`);let l=e.post.filter(h=>!h.hidden).slice(0,3).map(h=>({title:h.title,link:h.link,date:h.dateCreated})),c=e.post.map(h=>h.tags).filter(h=>h).reduce((h,y)=>h.concat(y),[]).map(h=>h),d=c.filter((h,y)=>c.indexOf(h)===y),u=e.post.map(h=>h.category),m=u.filter((h,y)=>u.indexOf(h)===y),p={asBlog:s.blog.asBlog[0]===!1?!1:`${s.blog.asBlog[0]}.html`,totalPages:n,tagLists:d,latestPost:l};i.writeFileSync(`./dist/${s.blog.asBlog[0]}/data/data-blog.json`,JSON.stringify(p)),i.readFile("./src/data/blog/blog.json","utf8",(h,y)=>{let T=JSON.parse(y),B=m.map(O=>this.createCategoryPost(T.post,O));i.writeFileSync(`./dist/${s.blog.asBlog[0]}/data/data-category.json`,JSON.stringify(B))}),i.readFile("./src/data/blog/blog.json","utf8",(h,y)=>{let T=JSON.parse(y),B=d.map(O=>this.createTagPost(T.post,O));B.forEach(O=>{O.posts.forEach(L=>{delete L.tags,delete L.blocks})}),i.writeFileSync(`./dist/${s.blog.asBlog[0]}/data/data-tag.json`,JSON.stringify(B))})}},600)};createCategoryPost=(e,o)=>{let s=e.filter(t=>t.category===o);return s.forEach(t=>{t.content=this.utils.trimString(t.blocks[0].data.text),t.date=t.dateCreated,delete t.author.id,delete t.blocks,delete t.share,delete t.category,delete t.tags,delete t.dateCreated,delete t.timeCreated,t.image||delete t.image}),{category:o,totalPost:s.length,posts:s}};createTagPost=(e,o)=>{let s=[];return e.forEach(t=>{t.tags.forEach(a=>{a===o&&s.push(t)})}),s.forEach(t=>{t.content=this.utils.trimString(t.blocks[0].data.text),t.date=t.dateCreated===void 0?t.date:t.dateCreated,delete t.author.id,delete t.share,delete t.dateCreated,delete t.timeCreated,t.image||delete t.image}),{tag:o,totalPost:s.length,posts:s}};postCreatePage=e=>{i.readdir("./src/data/blog/posts",(o,s)=>{let t={post:s.map(a=>JSON.parse(i.readFileSync(`./src/data/blog/posts/${a}`,"utf8")))};t.post.sort((a,n)=>new Date(`${n.dateCreated} ${n.timeCreated}`)-new Date(`${a.dateCreated} ${a.timeCreated}`)),i.readFile("./src/data/blog/blog.json","utf-8",(a,n)=>{let l=JSON.parse(n).post.map(c=>(delete c.dateModified,delete c.timeModified,c)),r=t.post.map(c=>(delete c.dateModified,delete c.timeModified,c));if(JSON.stringify(l)!==JSON.stringify(r)){let c={post:t.post.filter(d=>!d.hidden)};i.writeFileSync("./src/data/blog/blog.json",JSON.stringify(c,null,2))}}),this.postPaginatorPage(t,e)})};postsSaveContent=(e,o,s)=>{let t=JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[0];i.unlink(`./dist/${t}/*.html`,()=>{let a=s.singlePage.replace(/(?<={{> post-title)(.*?)(?= }})/g,`-${e}`);i.writeFileSync(`./src/data/blog/posts/${e}.json`,JSON.stringify(o,null,2)),o.hidden&&i.existsSync(`./dist/${t}/${o.link}`)&&i.unlinkSync(`./dist/${t}/${o.link}`),o.hidden===!1&&(i.writeFileSync(`./src/partials/blog/post-title-${e}.hbs`,s.singleSection),t!==!1&&i.writeFileSync(`./src/pages/${t}/${e}.hbs`,a)),this.postCreatePage(s)})};postsDeletePost=(e,o)=>{let s=JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[0],t=[`./src/data/blog/posts/${e}.json`,`./src/pages/${s}/${e}.hbs`,`./src/partials/blog/post-title-${e}.hbs`,`./dist/${s}/${e}.html`];return Promise.all(t.map(a=>!a.includes("false")&&i.unlinkSync(a))).then(this.socket.emit("deleteDone","success"),this.postCreatePage(o))};createEditorData=e=>{i.readFile(`./src/data/blog/posts/${e}.json`,"utf8",(o,s)=>this.socket.emit("editorData",s))};postsTagSources=()=>{let e={defaultPage:i.existsSync("./src/hooks/blog/pages/blog.hbs")?i.readFileSync("./src/hooks/blog/pages/blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog.hbs","utf8"),singlePage:i.existsSync("./src/hooks/blog/pages/blog-single.hbs")?i.readFileSync("./src/hooks/blog/pages/blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/pages/blog-single.hbs","utf8"),defaultSection:i.existsSync("./src/hooks/blog/sections/section-blog.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog.hbs","utf8"),singleSection:i.existsSync("./src/hooks/blog/sections/section-blog-single.hbs")?i.readFileSync("./src/hooks/blog/sections/section-blog-single.hbs","utf8"):i.readFileSync("./node_modules/blockit-builder/hooks/blog/sections/section-blog-single.hbs","utf8")};this.socket.emit("tagSourcesData",e)};findBlogTitle=(e,o,s)=>{if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]===s)return e;for(let t of Object.keys(e))if(typeof e[t]=="object"){let a=this.findBlogTitle(e[t],o,s);if(a!==null&&typeof a<"u")return a}return null};createBlogTitle=e=>{if(this.findBlogTitle(e,"link","blog/page-1.html")!==null){let o=JSON.parse(i.readFileSync("./src/data/setting.json","utf8")).blog.asBlog[0],s=this.findBlogTitle(e,"link","blog/page-1.html").title;i.readdir("./src/pages/blog",(t,a)=>{a.forEach(n=>{i.readFile(`./src/pages/${o}/${n}`,"utf8",(l,r)=>{let d=r.replace(/(?<=data-title=")([^"]*)/g,s.toLowerCase()).replace(/(?<=title:\s).*/g,s);i.writeFileSync(`./src/pages/${o}/${n}`,d)})})})}};changeBlogFrontmatter=(e,o,s)=>{let l=(i.existsSync(o)?i.readFileSync(o,"utf8"):i.readFileSync(s,"utf8")).replace(/(?<=layout:\s).*/g,e.layout).replace(/(?<=title:\s).*/g,e.title).replace(/(?<=breadcrumb:\s).*/g,e.breadcrumb);i.existsSync(o)?i.writeFileSync(o,l):i.writeFileSync(s,l)};createNavigationData=()=>{let e=JSON.parse(i.readFileSync("./src/data/setting.json","utf-8")).blog.asBlog[0],o=new RegExp(`${e}-page`),s=new RegExp(`${e}-find`),t={nav:JSON.parse(i.readFileSync("./src/data/navigation.json","utf8")),select:i.readdirSync("./src/pages","utf8").filter(a=>!a.match(o)&&!a.match(s)).filter(a=>a.match(/.(hbs)$/i))};this.socket.emit("navigationData",t)};saveNavigationData=e=>{i.writeFileSync("./src/data/navigation.json",JSON.stringify(e,null,2)),this.createBlogTitle(e)};assetsUpload=(e,o,s)=>{let t={};if(o.includes("author")?Object.assign(t,{width:72,height:72}):o.includes("featured")?Object.assign(t,{width:1130}):o.includes("post")?Object.assign(t,{width:980}):Object.assign(t,{width:null}),s==="svg"){let a=K.optimize;i.writeFileSync(`./dist/img/user/${o}`,a(e).data),this.socket.emit("uploadDone",`img/user/${o}`)}else G(e).resize(t).toFile(`./dist/img/user/${o}`,a=>{if(a)throw a;this.socket.emit("uploadDone",`img/user/${o}`)})};assetsDelete=e=>{i.existsSync(`./dist/img/user/${e}`)&&i.unlink(`./dist/img/user/${e}`,o=>{if(o)throw o;this.socket.emit("deleteDone","success")})};saveSettingsData=(e,o)=>{i.readFile("./src/assets/scss/theme/colors.scss","utf8",(s,t)=>{let a=t,y=a.replace(/(?<=primary:\s)([^;]*)/g,e.colors.primaryColor).replace(/(?<=secondary:\s)([^;]*)/g,e.colors.secondaryColor).replace(/(?<=success:\s)([^;]*)/g,e.colors.successColor).replace(/(?<=info:\s)([^;]*)/g,e.colors.infoColor).replace(/(?<=warning:\s)([^;]*)/g,e.colors.warningColor).replace(/(?<=danger:\s)([^;]*)/g,e.colors.dangerColor).replace(/(?<=light:\s)([^;]*)/g,e.colors.lightColor).replace(/(?<=dark:\s)([^;]*)/g,e.colors.darkColor).replace(/(?<=background:\s)([^;]*)/g,e.colors.backgroundColor).replace(/(?<=body:\s)([^;]*)/g,e.colors.bodyColor).replace(/(?<=link:\s)([^;]*)/g,e.colors.linkColor);a!==y&&i.writeFileSync("./src/assets/scss/theme/colors.scss",y)}),i.readFile("./src/data/setting.json","utf-8",(s,t)=>{t!==JSON.stringify(e,null,2)&&i.writeFileSync("./src/data/setting.json",JSON.stringify(e,null,2)),this.postCreatePage(o),this.updateAuthorData(t,e,o),this.runMinifying(t,e)})};runMinifying=(e,o)=>{let s=o.optimization.minifyAssets.css,t=o.optimization.minifyAssets.js,a=JSON.parse(e).optimization.minifyAssets.css!==s,n=JSON.parse(e).optimization.minifyAssets.js!==t;a&&s?this.compiler.minifyCss():a&&!s&&this.compiler.buildCss(),n&&t?this.compiler.minifyJs():n&&!t&&this.compiler.buildJs()};saveEmail=e=>{i.readFile("./dist/sendmail.php","utf8",(o,s)=>{if(String(s.match(/(?<=emailTo = ).*/g))!==`"${e}";`){let a=s.replace(/(?<=emailTo = ).*/g,`"${e}";`);i.writeFileSync("./dist/sendmail.php",a)}})};saveMap=e=>{i.readdir("./src/partials/sections",(o,s)=>{s.filter(a=>a.match(/section-contact/g)).forEach(a=>{i.readFile(`./src/partials/sections/${a}`,"utf8",(n,l)=>{let r=l.split(`
`)[0],c=new H(l),d=c.window.document.querySelector("iframe");if(d!==null){d.src=e;let u=r.concat(`
`,c.window.document.documentElement.childNodes[1].innerHTML);i.writeFileSync(`./src/partials/sections/${a}`,u)}})})})};saveSocialMedia=e=>{let o=e.filter(s=>Object.values(s)[0].length!==0).map(s=>{let t=Object.keys(s)[0];return`	<div><a href="${Object.values(s)[0]}" class="color-${t} text-decoration-none"><i class="fab fa-${t==="facebook"?"facebook-square":t}"></i> ${t.charAt(0).toUpperCase()+t.slice(1)}</a></div>`}).join(`
`);i.readFile("src/partials/components/component-social-media.hbs","utf8",(s,t)=>{let a=t.split(`
`)[0],n=new H(t),l=n.window.document.querySelector(".social-media-list")===null?!1:n.window.document.querySelector(".social-media-list");l&&(l.innerHTML=`
${o}
`);let r=a.concat(`
`,n.window.document.documentElement.childNodes[1].innerHTML);i.writeFileSync("src/partials/components/component-social-media.hbs",r)})};saveFooter=e=>{let o=JSON.parse(i.readFileSync("./blockit-config.json","utf8")).footerHook,{useLogo:s,logoIndex:t,showClass:a,hideClass:n,logoClass:l,copyrightClass:r}=o;i.readFile("./src/partials/components/component-footer.hbs","utf8",(c,d)=>{let u=d.split(`
`)[0],m=new H(d),k=m.window.document.querySelector(`.${r}`),p=m.window.document.querySelector(`.${l}`)===null?!1:m.window.document.querySelector(`.${l}`);s&&(e.siteLogo.enabled?(p.children[t].classList.add(a),p.children[t].classList.remove(n),p.children[t].setAttribute("src",`{{root}}${e.siteLogo.logo.src}`),p.children[t].setAttribute("width",e.siteLogo.logo.width),p.children[t].setAttribute("height",e.siteLogo.logo.height)):(p.children[t].classList.add(n),p.children[t].classList.remove(a))),k.innerHTML=e.copyrightText;let h=m.window.document.documentElement.childNodes[1].innerHTML.replace(/&gt;/g,">"),y=u.concat(`
`,h);i.writeFileSync("./src/partials/components/component-footer.hbs",y)})};saveSlideshow=e=>{let o=i.readFileSync("./node_modules/blockit-builder/hooks/slideshow/slideshow-wrapper.hbs","utf8");i.existsSync("./src/hooks/slideshow/slideshow-wrapper.hbs")&&(o=i.readFileSync("./src/hooks/slideshow/slideshow-wrapper.hbs","utf8"));let s=[{sectionName:"component-slideshow-1",slides:e[0].slides},{sectionName:"component-slideshow-2",slides:e[1].slides},{sectionName:"component-slideshow-3",slides:e[2].slides},{sectionName:"component-slideshow-4",slides:e[3].slides}],t=s.filter(n=>n.slides.length!==0),a=s.filter(n=>!t.includes(n)).map(n=>n.sectionName);e.forEach((n,l)=>{if(n.slides.length!==0){let r=n.slides.map(d=>d.text),c=o.replace(/\{\{slide-id\}\}/g,r.join(" "));i.writeFileSync("./node_modules/blockit-builder/templates/component-slideshow.json",JSON.stringify(t,null,4)),i.writeFileSync(`./src/partials/components/component-slideshow-${l+1}.hbs`,c)}}),a.forEach(n=>{i.existsSync(`./src/partials/components/${n}.hbs`)&&i.unlinkSync(`./src/partials/components/${n}.hbs`)})};createSettingsData=()=>{i.readFile("./src/data/setting.json","utf8",(e,o)=>this.socket.emit("settingsData",JSON.parse(o)))};createFooterData=()=>{i.readFile("./src/partials/components/component-footer.hbs","utf8",(e,o)=>{let s={blocks:[{id:"footer-content",type:"code",data:{language:"HTML",text:o}}]};this.socket.emit("footerData",s)})};saveFooterEditor=e=>{Object.keys(e).length!==0&&i.writeFileSync("./src/partials/components/component-footer.hbs",e)};createSlideItem=e=>{i.existsSync("./src/hooks/slideshow/slideshow-item.hbs")?this.createSlideData("./src/hooks/slideshow/slideshow-item.hbs",e):this.createSlideData("./node_modules/blockit-builder/hooks/slideshow/slideshow-item.hbs",e)};createSlideData=(e,o)=>{i.readFile(e,"utf8",(s,t)=>{let a={blocks:[{id:o,type:"code",data:{language:"HTML",text:t}}]};this.socket.emit("slideItem",a)})};createComponentsData=()=>{i.readFile("./src/data/component.json","utf8",(e,o)=>{let{useLogo:s}=JSON.parse(i.readFileSync("./blockit-config.json","utf-8")).footerHook,t=JSON.parse(o);t.footer.useLogo=s,this.socket.emit("componentsData",t)})};updateAuthorData=(e,o,s)=>{let t=JSON.parse(e).authors,a=o.authors,n=t.filter(this.utils.compareObj(a)),l=a.filter(this.utils.compareObj(t)),r=n.concat(l),c={post:[]};i.readdir("./src/data/blog/posts",(d,u)=>{u.forEach(m=>{let k=JSON.parse(i.readFileSync(`./src/data/blog/posts/${m}`,"utf8"));r.length!==0&&(Object.values(k).forEach(p=>{(p.id===r[0].id&&p.name!==r[1].name||p.id===r[0].id&&p.avatar!==r[1].avatar)&&(p.name=r[1].name,p.avatar=r[1].avatar)}),i.writeFileSync(`./src/data/blog/posts/${m}`,JSON.stringify(k,null,2))),c.post.push(k)}),c.post.sort((m,k)=>new Date(`${k.dateCreated} ${k.timeCreated}`)-new Date(`${m.dateCreated} ${m.timeCreated}`)),i.writeFileSync("./src/data/blog/blog.json",JSON.stringify(c,null,2)),this.postPaginatorPage(c,s)})};saveComponentsData=e=>{i.writeFileSync("./src/data/component.json",JSON.stringify(e,null,2)),this.saveEmail(e.contactMap.email),this.saveMap(e.contactMap.mapSrc),this.saveSlideshow(e.slideshow),this.saveFooter(e.footer),this.saveSocialMedia(e.socialMedia)}};var F=class{createDirectory=e=>!g.existsSync(e)&&g.mkdirSync(e);loadFiles=(e,o,s)=>(s||(s=[]),o||(o=[]),g.readdirSync(e).forEach(t=>{if(g.statSync(`${e}/${t}`).isDirectory()){let a=!1;o.forEach(n=>{n===t&&(a=!0)}),a||s.concat(this.loadFiles(`${e}/${t}`,o,s))}else s.push(`${e}/${t}`)}),s);optimizeImg=(e,o)=>{let s=Q.optimize;switch(w.extname(e)){case".jpg":case".jpeg":{E(e).jpeg({mozjpeg:!0}).toFile(`${o}/${w.basename(e)}`);break}case".png":{E(e).png({quality:80}).toFile(`${o}/${w.basename(e)}`);break}case".gif":{E(e).gif({reoptimize:!0}).toFile(`${o}/${w.basename(e)}`);break}case".webp":{E(e).webp({lossless:!0}).toFile(`${o}/${w.basename(e)}`);break}case".svg":{let t=g.readFileSync(e,"utf8");g.writeFileSync(`${o}/${w.basename(e)}`,s(t).data);break}}};logHeading=()=>{let e=JSON.parse(g.readFileSync("./node_modules/blockit-builder/package.json","utf-8"));console.log(`
${e.title} v${e.version} running on Node.js ${process.version}
`),process.argv.pop()!=="--build"&&(console.log("    builder url:    \x1B[35mhttp://localhost:3001   \x1B[0m"),console.log(`    preview url:    \x1B[35mhttp://localhost:3000
 \x1B[0m`),console.log(`${this.logTime(new Date)} - Waiting for changes...`))};logMessage=(e,o)=>{let s=JSON.parse(g.readFileSync("package.json","utf-8"));e==="begin"&&console.log("\x1B[33mProcessing...\x1B[0m"),e==="end"&&(process.stdout.moveCursor(0,-1),console.log(`${this.logTime(new Date)} - ${o}`)),e==="completed"&&console.log(`
\x1B[7m\x1B[32m DONE \x1B[0m\x1B[32m Project "${s.title}" ready.\x1B[0m
`)};logTime=e=>`\x1B[36m[${new Intl.DateTimeFormat("en",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h24"}).format(e)}]\x1B[0m`;frontmatter=(e,o)=>{let s=/(^-{3}(?:\r\n|\r|\n)([\w\W]*?)-{3}(?:\r\n|\r|\n))?([\w\W]*)*/;o=o||{};let t={data:null,content:""},a=e.match(s);if(a[2]!==void 0){let n=o.safeLoad?R.safeLoad:R.load;t.data=n(a[2])||{}}return a[3]!==void 0&&(t.content=a[3]),t};debounce=(e,o=800)=>{let s;return(...t)=>{clearTimeout(s),s=setTimeout(()=>{e.apply(this,t)},o)}};trimString(e){let o=e.indexOf(" ",150);return o===-1?e:e.substring(0,o)+" ..."}compareObj=e=>function(o){return e.filter(s=>s.name===o.name&&s.email===o.email&&s.role===o.role&&s.avatar===o.avatar).length===0};checkHook(){return g.readdirSync("./src/hooks","utf-8").length!==0}hookSearch=()=>{g.existsSync("./src/hooks/blog/search-post.hbs")&&g.existsSync("./src/hooks/blog/search-result.hbs")?this.hookSearchWrite("./src/hooks/blog/search-post.hbs","./src/hooks/blog/search-result.hbs"):this.hookSearchWrite("./node_modules/blockit-builder/hooks/blog/search-post.hbs","./node_modules/blockit-builder/hooks/blog/search-result.hbs")};hookSearchWrite=(e,o)=>{let s=g.readFileSync(e,"utf8"),t=g.readFileSync(o,"utf8");g.readFile("./src/assets/js/utilities/blog.js","utf8",(a,n)=>{let l=/(?<=notFoundDiv.innerHTML\s=\s`)([^`]*)(?=`)/,r=/(?<=return\s`)([^`]*)(?=`)/g,d=n.replace(l,t).replace(r,s);g.writeFileSync("./src/assets/js/utilities/blog.js",d)})};hookSections=()=>{let e=process.env.npm_package_title.toLowerCase(),o=["section-card","section-client-logo","section-contact","section-content","section-counter","section-faq","section-feature","section-gallery","section-pricing","section-team","section-testimonial","section-timeline","section-utility"],s=g.readdirSync("./src/hooks/sections/previews","utf-8"),t=JSON.parse(g.readFileSync("./src/data/component.json","utf-8")).slideshow,a=g.readdirSync("./src/hooks/sections","utf-8").filter(n=>n.includes(e)).sort((n,l)=>n.length-l.length).map(n=>({sectionName:n.split(".")[0],sectionTag:g.readFileSync(`./src/hooks/sections/${n}`,"utf8")}));this.createDirectory("./node_modules/blockit-builder/templates"),g.writeFileSync(`./node_modules/blockit-builder/templates/section-${e}.json`,JSON.stringify(a,null,4)),o.forEach(n=>{let l=g.readdirSync("./src/hooks/sections","utf8").filter(r=>r.includes(n)).sort((r,c)=>r.length-c.length).map(r=>({sectionName:r.split(".")[0],sectionTag:g.readFileSync(`./src/hooks/sections/${r}`,"utf8")}));g.writeFileSync(`./node_modules/blockit-builder/templates/${n.split(".")[0]}.json`,JSON.stringify(l,null,4))}),s.forEach(n=>{g.copyFileSync(`./src/hooks/sections/previews/${n}`,`./node_modules/blockit-builder/assets/img/sections/${n}`)}),new C().saveSlideshow(t)};hookSectionsRemove=e=>{if(w.extname(e)===".hbs"&&g.readdirSync("./src/hooks/sections","utf8").length===1){let o=w.basename(e,".hbs").split("-").slice(0,-1).join("-");g.existsSync(`./node_modules/blockit-builder/templates/${o}.json`)&&g.unlinkSync(`./node_modules/blockit-builder/templates/${o}.json`)}w.extname(e)===".webp"&&g.unlinkSync(`./node_modules/blockit-builder/assets/img/sections/${w.basename(e)}`)}};function I(f,e,o){return f===!1&&e===!1?o.inverse(this):f===!0&&e===!1?o.fn(this):f===!1&&e===!0?o.fn(this):o.fn(this)}function q(f,e,o){return f===e?o.fn(this):o.inverse(this)}function z(f){return function(){let e=Array.prototype.slice.call(arguments),o=e.slice(0,-1),s=e[e.length-1];for(let t in o)if(o[t]===f)return s.fn(this);return""}}function W(f){return function(){let e=Array.prototype.slice.call(arguments),o=e.slice(0,-1),s=e[e.length-1];for(let t in o)if(o[t]===f)return"";return s.fn(this)}}var x=class{constructor(e){this.Handlebars=X,this.options=e,this.utils=new F}loadPartials=e=>{this.utils.loadFiles(e).forEach(s=>{let t=N.basename(s,".hbs"),a=S.readFileSync(s,"utf-8");this.Handlebars.registerPartial(t,a+`
`)})};loadData=e=>{let s=this.utils.loadFiles(e).filter(t=>!t.includes("posts")).map(t=>({[N.basename(t,".json").replace(/-([a-z-0-9])/g,n=>n[1].toUpperCase())]:JSON.parse(S.readFileSync(t,"utf-8"))}));return Object.assign({},...s)};loadHelpers=()=>{this.Handlebars.registerHelper("ifand",I),this.Handlebars.registerHelper("ifequal",q)};loadPages=e=>{S.readdirSync(e).forEach(async o=>{let s=N.join(e,o);S.lstatSync(s).isDirectory()?this.loadPages(s):this.compileHbs(s)})};minifyHtml=e=>e.replace(/\s{2,}/g,"").replace(/\n/g,"").replace(/\t/g,"").replace(/<!--.*?-->/g,"");compileHbs=async e=>{let o=await this.loadData(this.options.data),s=S.readFileSync(e,"utf-8"),a={...{layout:this.utils.frontmatter(s).data.layout,title:this.utils.frontmatter(s).data.title,breadcrumb:this.utils.frontmatter(s).data.breadcrumb,asBlog:this.utils.frontmatter(s).data.asBlog,asSingle:this.utils.frontmatter(s).data.asSingle===void 0?!1:this.utils.frontmatter(s).data.asSingle,page:N.basename(e,".hbs"),path:e,root:e.split(N.sep).length>3?"../":"",body:this.utils.frontmatter(s).content},...o};this.Handlebars.registerHelper("ifpage",z(a.page)),this.Handlebars.registerHelper("unlesspage",W(a.page));let n=S.readFileSync(`./src/layouts/${a.layout}.hbs`,"utf-8");this.Handlebars.registerPartial("body",a.body+`
`);let l=a.path.split(N.sep),r=this.Handlebars.compile(n);if(l.length>3&&!S.existsSync(`./dist/${l[2]}`)&&S.mkdirSync(`./dist/${l[2]}`),a.asSingle){let c={...a,blog:JSON.parse(S.readFileSync(`./src/data/blog/posts/${a.page}.json`,"utf-8"))};c.blog.hidden===!1&&this.options.minify?S.writeFileSync(`./dist/${l[2]}/${c.page}.html`,this.minifyHtml(r(c))):c.blog.hidden===!1&&S.writeFileSync(`./dist/${l[2]}/${c.page}.html`,r(c).replace(/\t/g,""))}else this.options.minify?S.writeFileSync(`./dist/${a.page}.html`,this.minifyHtml(r(a))):S.writeFileSync(`./dist/${a.page}.html`,r(a).replace(/\t/g,""))};render=()=>{this.loadHelpers(),this.loadPartials(this.options.partials),this.loadPages(this.options.pages)}};var j=class{constructor(e){this.utils=new F,this.env=e}buildClean=()=>{[...this.utils.loadFiles("./dist",["blog","img"]),...this.utils.loadFiles("./dist/blog",["data"]),...this.utils.loadFiles("./dist/img",["user"])].forEach(o=>b.unlinkSync(o))};buildHtml=()=>{this.utils.logMessage("begin");let e=JSON.parse(b.readFileSync("./src/data/setting.json","utf-8")).optimization.minifyAssets.html;new x({pages:"./src/pages",layout:"./src/layout",partials:"./src/partials",data:"./src/data",minify:e}).render(),this.utils.logMessage("end","Html compiled successfully.")};buildCss=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/css");let e=_.compile("./src/assets/scss/main.scss",{logger:_.Logger.silent,style:"expanded"});b.writeFileSync("./dist/css/style.css",e.css),this.utils.logMessage("end","Css compiled successfully.")};buildJs=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/js"),this.utils.createDirectory("./dist/js/vendors"),this.utils.loadFiles("./src/assets/js",["utilities","vendors"]).forEach(t=>b.copyFileSync(t,`./dist/js/${$.basename(t)}`));let o=this.utils.loadFiles("./src/assets/js/utilities").map(t=>b.readFileSync(t,"utf-8"));A.transform(o.join(""),{root:"./node_modules/blockit-builder",minified:!0,comments:!1},(t,a)=>{b.writeFileSync("./dist/js/utilities.min.js",a.code)}),this.utils.loadFiles("./src/assets/js/vendors").filter(t=>$.extname(t)===".js").forEach(t=>b.copyFileSync(t,`./dist/js/vendors/${$.basename(t)}`)),this.utils.logMessage("end","Js compiled successfully.")};buildImg=async()=>{this.utils.logMessage("begin"),this.utils.loadFiles("./src/assets/img",["blockit"]).forEach(e=>{this.utils.optimizeImg(e,"./dist/img")}),this.utils.loadFiles("./src/assets/img/blockit").forEach(e=>{this.utils.optimizeImg(e,"./dist/img/blockit")}),this.utils.logMessage("end","Images optimized successfully.")};buildStatic=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/fonts"),this.utils.loadFiles("./src/assets/fonts").forEach(t=>b.copyFileSync(t,`./dist/fonts/${$.basename(t)}`));let o=this.utils.loadFiles("./node_modules/@fortawesome/fontawesome-free/webfonts");o.filter(t=>t.includes("fa-brands-400")).forEach(t=>b.copyFileSync(t,`./dist/fonts/${$.basename(t)}`)),o.filter(t=>t.includes("fa-solid-900")).forEach(t=>b.copyFileSync(t,`./dist/fonts/${$.basename(t)}`)),b.copyFileSync("./src/assets/favicon/favicon.ico","./dist/img/favicon.ico"),b.copyFileSync("./src/assets/favicon/apple-touch-icon.png","./dist/img/apple-touch-icon.png"),b.copyFileSync("./src/assets/php/sendmail.php","./dist/sendmail.php");let{jsVendors:s}=JSON.parse(b.readFileSync("./blockit-config.json","utf-8"));s!==void 0&&s.forEach(t=>{$.basename(t).split(".").includes("min")?b.readFile(t,"utf-8",(n,l)=>{b.writeFileSync(`./dist/js/vendors/${$.basename(t)}`,l.replace(/\/\/[#@]\s(source(?:Mapping)?URL)=\s*(\S+)/,"").replace(/[^\S\n\r]*\n$/,""))}):A.transformFile(t,{minified:!0,comments:!1},(n,l)=>{b.writeFileSync(`./dist/js/vendors/${$.basename(t,".js")}.min.js`,l.code)})}),this.utils.logMessage("end","Static assets delivered successfully.")};minifyCss=()=>{this.utils.logMessage("begin");let e=_.compile("./src/assets/scss/main.scss",{logger:_.Logger.silent,style:"compressed"}).css;b.writeFileSync("./dist/css/style.css",e),this.utils.logMessage("end","Css minifying successfully.")};minifyJs=()=>{this.utils.logMessage("begin"),this.utils.loadFiles("./src/assets/js",["utilities","vendors"]).map(s=>({name:s,code:A.transformFileSync(s,{root:"./node_modules/blockit-builder",minified:!0,comments:!1}).code})).forEach(s=>b.writeFileSync(`./dist/js/${$.basename(s.name)}`,s.code)),this.utils.logMessage("end","Js minifying successfully.")};previewWatch=e=>{let o={ignoreInitial:!0};v.watch("./src/assets/scss/**/*.scss").on("change",this.utils.debounce(()=>{this.buildCss(),e.reload()})),v.watch("./src/assets/js/**/*.js").on("change",this.utils.debounce(()=>{this.buildJs(),e.reload()})),v.watch("./src/assets/img/**/*",o).on("all",this.utils.debounce(()=>{this.buildImg(),e.reload()})),v.watch(["./src/**/*.hbs","./src/data/**/*.json"],o).on("all",this.utils.debounce(()=>{this.buildHtml(),e.reload()})),v.watch(["./src/hooks/blog/search-post.hbs","./src/hooks/blog/search-result.hbs"]).on("change",()=>this.utils.hookSearch()),v.watch(["./src/hooks/sections/*.hbs","./src/hooks/sections/previews/*.webp"],o).on("unlink",s=>this.utils.hookSectionsRemove(s))};builderWatch=(e,o)=>{o==="DEV"&&v.watch(["./node_modules/blockit-builder/assets/app.js","./node_modules/blockit-builder/assets/app.css"]).on("change",this.utils.debounce(()=>e.reload()))}};var J=class{constructor(e){this.blockit=e}dashboardSocket=e=>{e.on("getDashboardData",()=>this.blockit.createDashboardData())};pagesSocket=e=>{e.on("getPagesData",()=>this.blockit.createPagesData()),e.on("getPagesActionData",()=>this.blockit.createPagesActionData()),e.on("deletePageData",(o,s)=>this.blockit.pagesDeletePage(o,s)),e.on("savePageActionData",o=>this.blockit.pagesSavePage(o)),e.on("readSectionData",o=>this.blockit.readSectionData(o)),e.on("readSectionsEdit",o=>this.blockit.readSectionsEdit(o)),e.on("saveSectionData",(o,s)=>this.blockit.createSectionData(o,s))};navigationSocket=e=>{e.on("getNavigationData",()=>this.blockit.createNavigationData()),e.on("saveNavigation",o=>this.blockit.saveNavigationData(o))};postsSocket=e=>{e.on("getPostsData",()=>this.blockit.createPostsData()),e.on("deletePostData",(o,s)=>this.blockit.postsDeletePost(o,s)),e.on("getPostsActionData",o=>this.blockit.createPostsActionData(o)),e.on("savePostContent",(o,s,t)=>this.blockit.postsSaveContent(o,s,t)),e.on("getEditorData",o=>this.blockit.createEditorData(o)),e.on("triggerTagSources",()=>this.blockit.postsTagSources())};componentsSocket=e=>{e.on("getComponentsData",()=>this.blockit.createComponentsData()),e.on("saveComponents",o=>this.blockit.saveComponentsData(o)),e.on("getSlideItem",o=>this.blockit.createSlideItem(o))};settingsSocket=e=>{e.on("getSettingsData",()=>this.blockit.createSettingsData()),e.on("getFooterData",()=>this.blockit.createFooterData()),e.on("saveFooterEditor",o=>this.blockit.saveFooterEditor(o)),e.on("saveSettingsData",(o,s)=>this.blockit.saveSettingsData(o,s)),e.on("assetsUpload",(o,s,t)=>this.blockit.assetsUpload(o,s,t)),e.on("assetsDelete",o=>this.blockit.assetsDelete(o))}};import U from"browser-sync";var P=class{constructor(e,o){this.preview=U.create(),this.builder=U.create(),this.compiler=e,this.env=o}run=()=>{this.preview.init({port:3e3,ui:!1,notify:!1,open:!1,server:"./dist",callbacks:{ready:(e,o)=>{o.addMiddleware("*",(s,t)=>{t.writeHead(302,{location:"/404.html"}),t.end("Redirecting!")}),this.compiler.previewWatch(this.preview)}}}),this.builder.init({port:3001,ui:!1,notify:!1,server:"./node_modules/blockit-builder",single:!0,snippetOptions:{async:!1},logLevel:"silent",callbacks:{ready:(e,o)=>{o.io.sockets.on("connection",s=>{let t=new C(s),a=new J(t);a.dashboardSocket(s),a.pagesSocket(s),a.navigationSocket(s),a.postsSocket(s),a.componentsSocket(s),a.settingsSocket(s)}),this.compiler.builderWatch(this.builder,this.env)}}})}};var V="DEV",D=new j(V),Y=new P(D,V),M=new F,Z=async()=>{M.logHeading(),D.buildClean(),D.buildHtml(),D.buildCss(),D.buildJs(),await D.buildImg(),D.buildStatic(),M.logMessage("completed")},ee=()=>{M.logHeading(),M.hookSections(),Y.run()},se=()=>process.argv.includes("--build")?Z():ee();se();
