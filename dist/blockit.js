import h from"fs";import J from"path";import H from"sass";import W from"@babel/core";import j from"chokidar";import{PurgeCSS as X}from"purgecss";import y from"fs";import O from"path";import Q from"handlebars";import b from"fs";import L from"js-yaml";import v from"path";import T from"sharp";import K from"svgo";var k=class{createDirectory=e=>!b.existsSync(e)&&b.mkdirSync(e);loadFiles=(e,t,s)=>(s||(s=[]),t||(t=[]),b.readdirSync(e).forEach(i=>{if(b.statSync(`${e}/${i}`).isDirectory()){let a=!1;t.forEach(l=>{l===i&&(a=!0)}),a||s.concat(this.loadFiles(`${e}/${i}`,t,s))}else s.push(`${e}/${i}`)}),s);optimizeImg=(e,t)=>{let s=K.optimize;switch(v.extname(e)){case".jpg":case".jpeg":{T(e).jpeg({mozjpeg:!0}).toFile(`${t}/${v.basename(e)}`);break}case".png":{T(e).png({quality:80}).toFile(`${t}/${v.basename(e)}`);break}case".gif":{T(e).gif({reoptimize:!0}).toFile(`${t}/${v.basename(e)}`);break}case".webp":{T(e).webp({lossless:!0}).toFile(`${t}/${v.basename(e)}`);break}case".svg":{let i=b.readFileSync(e,"utf8");b.writeFileSync(`${t}/${v.basename(e)}`,s(i).data);break}}};logHeading=()=>{let e=JSON.parse(b.readFileSync("./node_modules/blockit-builder/package.json","utf-8"));console.log(`
${e.title} v${e.version} running on Node.js ${process.version}
`),process.argv.pop()!=="--build"&&(console.log("    builder url:    \x1B[35mhttp://localhost:3001   \x1B[0m"),console.log(`    preview url:    \x1B[35mhttp://localhost:3000
 \x1B[0m`),console.log(`${this.logTime(new Date)} - Waiting for changes...`))};logMessage=(e,t)=>{let s=JSON.parse(b.readFileSync("package.json","utf-8"));e==="begin"&&console.log("\x1B[33mProcessing...\x1B[0m"),e==="end"&&(process.stdout.moveCursor(0,-1),console.log(`${this.logTime(new Date)} - ${t}`)),e==="completed"&&console.log(`
\x1B[7m\x1B[32m DONE \x1B[0m\x1B[32m Project "${s.title}" ready.\x1B[0m
`)};logTime=e=>`\x1B[36m[${new Intl.DateTimeFormat("en",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h24"}).format(e)}]\x1B[0m`;frontmatter=(e,t)=>{let s=/(^-{3}(?:\r\n|\r|\n)([\w\W]*?)-{3}(?:\r\n|\r|\n))?([\w\W]*)*/;t=t||{};let i={data:null,content:""},a=e.match(s);if(a[2]!==void 0){let l=t.safeLoad?L.safeLoad:L.load;i.data=l(a[2])||{}}return a[3]!==void 0&&(i.content=a[3]),i};debounce=(e,t=800)=>{let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>{e.apply(this,i)},t)}};trimString(e){let t=e.indexOf(" ",150);return t===-1?e:e.substring(0,t)+" ..."}compareObj=e=>function(t){return e.filter(s=>s.name===t.name&&s.email===t.email&&s.role===t.role&&s.avatar===t.avatar).length===0};checkHook(){return b.readdirSync("./src/hooks","utf-8").length!==0}hookSearch=()=>{b.existsSync("./src/hooks/blog/search-post.hbs")&&b.existsSync("./src/hooks/blog/search-result.hbs")?this.hookSearchWrite("./src/hooks/blog/search-post.hbs","./src/hooks/blog/search-result.hbs"):this.hookSearchWrite("./node_modules/blockit-builder/hooks/blog/search-post.hbs","./node_modules/blockit-builder/hooks/blog/search-result.hbs")};hookSearchWrite=(e,t)=>{let s=b.readFileSync(e,"utf8"),i=b.readFileSync(t,"utf8");b.readFile("./src/assets/js/utilities/blog.js","utf8",(a,l)=>{let c=/(?<=notFoundDiv.innerHTML\s=\s`)([^`]*)(?=`)/,r=/(?<=return\s`)([^`]*)(?=`)/g,p=l.replace(c,i).replace(r,s);b.writeFileSync("./src/assets/js/utilities/blog.js",p)})};hookSectionsPreview=(e,t)=>{e==="add"&&b.copyFileSync(t,`./node_modules/blockit-builder/assets/img/sections/${v.basename(t)}`),e==="unlink"&&b.unlinkSync(`./node_modules/blockit-builder/assets/img/sections/${v.basename(t)}`)}};function I(f,e,t){return f==!1&&e==!1?t.inverse(this):f==!0&&e==!1?t.fn(this):f==!1&&e==!0?t.fn(this):t.fn(this)}function z(f,e,t){return f===e?t.fn(this):t.inverse(this)}function q(f){var e=Array.prototype.slice.call(arguments),t=e.slice(0,-1),s=e[e.length-1];for(var i in t)if(t[i]===f)return s.fn(this);return""}function R(f){var e=Array.prototype.slice.call(arguments),t=e.slice(0,-1),s=e[e.length-1];for(var i in t)if(t[i]===f)return"";return s.fn(this)}var N=class{constructor(e){this.Handlebars=Q,this.options=e,this.utils=new k}loadPartials=e=>{this.utils.loadFiles(e).forEach(s=>{let i=O.basename(s,".hbs"),a=y.readFileSync(s,"utf-8");this.Handlebars.registerPartial(i,a+`
`)})};loadData=e=>{let s=this.utils.loadFiles(e).filter(i=>!i.includes("posts")).map(i=>({[O.basename(i,".json").replace(/-([a-z-0-9])/g,l=>l[1].toUpperCase())]:JSON.parse(y.readFileSync(i,"utf-8"))}));return Object.assign({},...s)};loadHelpers=()=>{this.Handlebars.registerHelper("ifand",I),this.Handlebars.registerHelper("ifequal",z),this.Handlebars.registerHelper("ifpage",q),this.Handlebars.registerHelper("unlessPage",R)};loadPages=e=>{y.readdirSync(e).forEach(async t=>{let s=O.join(e,t);y.lstatSync(s).isDirectory()?this.loadPages(s):this.compileHbs(s)})};minifyHtml=e=>e.replace(/\s{2,}/g,"").replace(/\n/g,"").replace(/\t/g,"").replace(/<!--.*?-->/g,"");compileHbs=async e=>{let t=await this.loadData(this.options.data),s=y.readFileSync(e,"utf-8"),a={...{layout:this.utils.frontmatter(s).data.layout,title:this.utils.frontmatter(s).data.title,breadcrumb:this.utils.frontmatter(s).data.breadcrumb,asBlog:this.utils.frontmatter(s).data.asBlog,asSingle:this.utils.frontmatter(s).data.asSingle===void 0?!1:this.utils.frontmatter(s).data.asSingle,page:O.basename(e,".hbs"),path:e,root:e.split(O.sep).length>3?"../":"",body:this.utils.frontmatter(s).content},...t},l=y.readFileSync(`./src/layouts/${a.layout}.hbs`,"utf-8");this.Handlebars.registerPartial("body",a.body+`
`);let c=a.path.split(O.sep),r=this.Handlebars.compile(l);if(c.length>3&&!y.existsSync(`./dist/${c[2]}`)&&y.mkdirSync(`./dist/${c[2]}`),a.asSingle){let n={...a,blog:JSON.parse(y.readFileSync(`./src/data/blog/posts/${a.page}.json`,"utf-8"))};n.blog.hidden===!1&&this.options.minify?y.writeFileSync(`./dist/${c[2]}/${n.page}.html`,this.minifyHtml(r(n))):n.blog.hidden===!1&&y.writeFileSync(`./dist/${c[2]}/${n.page}.html`,r(n).replace(/\t/g,""))}else this.options.minify?y.writeFileSync(`./dist/${a.page}.html`,this.minifyHtml(r(a))):y.writeFileSync(`./dist/${a.page}.html`,r(a).replace(/\t/g,""))};render=()=>{this.loadHelpers(),this.loadPartials(this.options.partials),this.loadPages(this.options.pages)}};var P=class{constructor(e){this.utils=new k,this.env=e}buildClean=()=>{[...this.utils.loadFiles("./dist",["blog","img"]),...this.utils.loadFiles("./dist/blog",["data"]),...this.utils.loadFiles("./dist/img",["user"])].forEach(t=>h.unlinkSync(t))};buildHtml=()=>{this.utils.logMessage("begin");let e=JSON.parse(h.readFileSync("./src/data/setting.json","utf-8")).optimization.minifyAssets.html;new N({pages:"./src/pages",layout:"./src/layout",partials:"./src/partials",data:"./src/data",minify:e}).render(),this.utils.logMessage("end","Html compiled successfully.")};buildCss=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/css");let e=H.compile("./src/assets/scss/main.scss",{logger:H.Logger.silent,style:"expanded"});h.writeFileSync("./dist/css/style.css",e.css),this.utils.logMessage("end","Css compiled successfully.")};buildJs=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/js"),this.utils.createDirectory("./dist/js/vendors"),this.utils.loadFiles("./src/assets/js",["utilities","vendors"]).forEach(i=>h.copyFileSync(i,`./dist/js/${J.basename(i)}`));let t=this.utils.loadFiles("./src/assets/js/utilities").map(i=>h.readFileSync(i,"utf-8"));W.transform(t.join(""),{root:"./node_modules/blockit-builder",minified:!0,comments:!1},(i,a)=>{h.writeFileSync("./dist/js/utilities.min.js",a.code)}),this.utils.loadFiles("./src/assets/js/vendors").forEach(i=>h.copyFileSync(i,`./dist/js/vendors/${J.basename(i)}`)),this.utils.logMessage("end","Js compiled successfully.")};buildImg=async()=>{this.utils.logMessage("begin"),this.utils.loadFiles("./src/assets/img",["blockit"]).forEach(e=>{this.utils.optimizeImg(e,"./dist/img")}),this.utils.loadFiles("./src/assets/img/blockit").forEach(e=>{this.utils.optimizeImg(e,"./dist/img/blockit")}),this.utils.logMessage("end","Images optimized successfully.")};buildStatic=()=>{this.utils.logMessage("begin"),this.utils.createDirectory("./dist/fonts"),this.utils.loadFiles("./src/assets/fonts").forEach(s=>h.copyFileSync(s,`./dist/fonts/${J.basename(s)}`));let t=this.utils.loadFiles("./node_modules/@fortawesome/fontawesome-free/webfonts");t.filter(s=>s.includes("fa-brands-400")).forEach(s=>h.copyFileSync(s,`./dist/fonts/${J.basename(s)}`)),t.filter(s=>s.includes("fa-solid-900")).forEach(s=>h.copyFileSync(s,`./dist/fonts/${J.basename(s)}`)),h.copyFileSync("./src/assets/favicon/favicon.ico","./dist/img/favicon.ico"),h.copyFileSync("./src/assets/favicon/apple-touch-icon.png","./dist/img/apple-touch-icon.png"),h.copyFileSync("./src/assets/php/sendmail.php","./dist/sendmail.php"),process.env.npm_package_dependencies_bootstrap!==void 0&&(h.readFile("./node_modules/bootstrap/dist/js/bootstrap.bundle.min.js","utf-8",(s,i)=>{h.writeFileSync("./dist/js/vendors/bootstrap.bundle.min.js",i.replace("//# sourceMappingURL=bootstrap.bundle.min.js.map",""))}),h.copyFileSync("./node_modules/isotope-layout/dist/isotope.pkgd.min.js","./dist/js/vendors/isotope.min.js"),h.copyFileSync("./node_modules/bigger-picture/dist/bigger-picture.min.js","./dist/js/vendors/bigger-picture.min.js")),process.env.npm_package_dependencies_uikit!==void 0&&h.copyFileSync("./node_modules/uikit/dist/js/uikit.min.js","./dist/js/vendors/uikit.min.js"),this.utils.logMessage("end","Static assets delivered successfully.")};minifyCss=async()=>{this.utils.logMessage("begin");let e=H.compile("./src/assets/scss/main.scss",{logger:H.Logger.silent,style:"compressed"}).css,t=await new X().purge({content:["./dist/*.html","./dist/js/**/*.js"],css:[{raw:e}]});h.writeFileSync("./dist/css/style.css",t[0].css),this.utils.logMessage("end","Css minifying successfully.")};minifyJs=()=>{this.utils.logMessage("begin"),this.utils.loadFiles("./src/assets/js",["utilities","vendors"]).map(s=>({name:s,code:W.transformFileSync(s,{root:"./node_modules/blockit-builder",minified:!0,comments:!1}).code})).forEach(s=>h.writeFileSync(`./dist/js/${J.basename(s.name)}`,s.code)),this.utils.logMessage("end","Js minifying successfully.")};previewWatch=e=>{let t={ignoreInitial:!0};j.watch("./src/assets/scss/**/*.scss").on("change",this.utils.debounce(()=>{this.buildCss(),e.reload()})),j.watch("./src/assets/js/**/*.js").on("change",this.utils.debounce(()=>{this.buildJs(),e.reload()})),j.watch("./src/assets/img/**/*",t).on("all",this.utils.debounce(()=>{this.buildImg(),e.reload()})),j.watch(["./src/**/*.hbs","./src/data/**/*.json"],t).on("all",this.utils.debounce(()=>{this.buildHtml(),e.reload()})),j.watch(["./src/hooks/blog/search-post.hbs","./src/hooks/blog/search-result.hbs"]).on("change",()=>this.utils.hookSearch()),j.watch("./src/hooks/sections/previews/*",t).on("all",(s,i)=>this.utils.hookSectionsPreview(s,i))};builderWatch=(e,t)=>{t==="DEV"&&j.watch(["./node_modules/blockit-builder/assets/app.js","./node_modules/blockit-builder/assets/app.css"]).on("change",this.utils.debounce(()=>e.reload()))}};import o from"fs";import{JSDOM as A}from"jsdom";import Y from"sharp";import Z from"svgo";var E=class{constructor(e){this.socket=e,this.utils=new k,this.compiler=new P}createDashboardData=()=>{let e={name:JSON.parse(o.readFileSync("./node_modules/blockit-builder/package.json","utf-8")).title,theme:process.env.npm_package_title,version:JSON.parse(o.readFileSync("./node_modules/blockit-builder/package.json","utf-8")).version,pages:o.readdirSync("./src/pages","utf8").filter(t=>t.match(/.(hbs)$/i)).filter(t=>!t.match(/blog-page/g)&&!t.match(/blog-find/g)).length,posts:o.readdirSync("./src/data/blog/posts","utf8").length,authors:JSON.parse(o.readFileSync("./src/data/setting.json","utf8")).authors.length};this.socket.emit("dashboardData",e)};createPagesData=()=>{o.readdir("./src/pages",(e,t)=>{let s=t.filter(i=>i.match(/.(hbs)$/i)).filter(i=>!i.match(/blog-page/g)&&!i.match(/blog-find/g)).map(i=>({page:i.split(".").slice(0,-1).join("."),title:o.readFileSync(`./src/pages/${i}`,"utf8").match(/(?<=title:\s).*/g)[0],date:o.statSync(`./src/pages/${i}`).mtime,layout:o.readFileSync(`./src/pages/${i}`,"utf8").match(/(?<=layout:\s).*/g)[0],breadcrumb:o.readFileSync(`./src/pages/${i}`,"utf8").match(/(?<=breadcrumb:\s).*/g)[0],sections:o.readFileSync(`./src/pages/${i}`,"utf8").match(/{{>(.*?)}}*/g).map(a=>a.substring(4).slice(0,-3))}));this.socket.emit("pagesData",s)}),o.readFile("./src/data/setting.json","utf8",(e,t)=>{let s=JSON.parse(t).blog.asBlog===!1?!1:JSON.parse(t).blog.asBlog.split(".")[0];this.socket.emit("pagesCurrentBlog",s)})};createPagesActionData=()=>{o.readdir("./node_modules/blockit-builder/templates",(e,t)=>{let s=t.filter(n=>n.match(/.(hbs)$/i)),i=o.readdirSync("./src/hooks/sections","utf-8").filter(n=>!n.includes("blog")).filter(n=>n.match(/.(hbs)$/i)),a=this.utils.checkHook()&&i.length!==0?i:!1,c={name:`Exclusive - ${a===!1?"empty":a[0].split("-")[1].charAt(0).toUpperCase()+a[0].split("-")[1].slice(1)}`,sections:a,icon:"ri-award-line"},r=[{name:"Card",sections:s.filter(n=>n.includes("card")),icon:"ri-sticky-note-line"},{name:"Client logo",sections:s.filter(n=>n.includes("client-logo")),icon:"ri-bubble-chart-line"},{name:"Contact",sections:s.filter(n=>n.includes("contact")),icon:"ri-road-map-line"},{name:"Content",sections:s.filter(n=>n.includes("content")),icon:"ri-file-text-line"},{name:"Counter",sections:s.filter(n=>n.includes("counter")),icon:"ri-timer-line"},{name:"Faq",sections:s.filter(n=>n.includes("faq")),icon:"ri-questionnaire-line"},{name:"Feature",sections:s.filter(n=>n.includes("feature")),icon:"ri-stack-line"},{name:"Gallery",sections:s.filter(n=>n.includes("gallery")),icon:"ri-gallery-line"},{name:"Pricing",sections:s.filter(n=>n.includes("pricing")),icon:"ri-price-tag-3-line"},{name:"Slideshow",sections:s.filter(n=>n.includes("slideshow")),icon:"ri-slideshow-2-line"},{name:"Team",sections:s.filter(n=>n.includes("team")),icon:"ri-user-line"},{name:"Testimonial",sections:s.filter(n=>n.includes("testimonial")),icon:"ri-chat-quote-line"},{name:"Timeline",sections:s.filter(n=>n.includes("timeline")),icon:"ri-history-line"},{name:"Utility",sections:s.filter(n=>n.includes("utility")),icon:"ri-tools-line"}];a!==!1&&r.splice(5,0,c),this.socket.emit("pagesActionData",r)})};pagesDeletePage=(e,t)=>{o.readFile(`./src/pages/${e}.hbs`,"utf8",(s,i)=>{i.match(/(?<=asBlog:\s).*/g)[0]==="false"?(o.unlinkSync(`./dist/${e}.html`),o.unlinkSync(`./src/pages/${e}.hbs`),t!==void 0&&t.forEach(l=>!l.includes("section-slideshow")&&o.unlinkSync(`./src/partials/sections/${l}.hbs`))):(o.unlinkSync(`./dist/${e}.html`),o.unlinkSync(`./src/pages/${e}.hbs`),o.unlinkSync("./dist/blog-find.html"),o.unlinkSync("./src/pages/blog-find.hbs"),o.readdir("./src/pages",(l,c)=>{c.filter(r=>r.match(/.(hbs)$/i)).filter(r=>r.match(/blog-page/g)).forEach(r=>{o.unlinkSync(`./dist/${r.split(".").slice(0,-1)[0]}.html`),o.unlinkSync(`./src/pages/${r}`)})}),o.readFile("./src/data/setting.json","utf8",(l,c)=>{let r=JSON.parse(c);r.blog.asBlog=!1,o.writeFileSync("./src/data/setting.json",JSON.stringify(r,null,2)),this.socket.emit("pagesCurrentBlog",r.blog.asBlog)}),o.readFile("./src/assets/js/utilities/breadcrumb.js","utf8",(l,c)=>{let r=c.replace(/(?<=this\.blogPath\s=\s).*/g,!1);o.writeFileSync("./src/assets/js/utilities/breadcrumb.js",r)}),o.readFile("./src/assets/js/utilities/active-menu.js","utf8",(l,c)=>{let r=c.replace(/(?<=this\.blogPath\s=\s).*/g,!1);o.writeFileSync("./src/assets/js/utilities/active-menu.js",r)}))})};pagesSavePage=e=>{e.blogStatus?o.readFile("./src/data/setting.json","utf8",(t,s)=>{let i=JSON.parse(s);i.blog.asBlog=`${e.nameFile}.hbs`,o.writeFileSync("./src/data/setting.json",JSON.stringify(i,null,2)),o.readFile("./src/assets/js/utilities/breadcrumb.js","utf8",(l,c)=>{let r=c.replace(/(?<=this\.blogPath\s=\s).*/g,`'${e.nameFile}.html'`);o.writeFileSync("./src/assets/js/utilities/breadcrumb.js",r)}),o.readFile("./src/assets/js/utilities/active-menu.js","utf8",(l,c)=>{let r=c.replace(/(?<=this\.blogPath\s=\s).*/g,`'${e.nameFile}.html'`);o.writeFileSync("./src/assets/js/utilities/active-menu.js",r)}),this.changeBlogFrontmatter(e.data,"./src/hooks/pages/blog.hbs","./node_modules/blockit-builder/hooks/pages/blog.hbs"),this.changeBlogFrontmatter(e.data,"./src/hooks/pages/blog-single.hbs","./node_modules/blockit-builder/hooks/pages/blog-single.hbs"),this.changeBlogFrontmatter(e.data,"./src/hooks/pages/blog-find.hbs","./node_modules/blockit-builder/hooks/pages/blog-find.hbs"),o.readdir("./src/pages/blog",(l,c)=>{c.forEach(r=>this.changeBlogFrontmatter(e.data,`./src/pages/blog/${r}`))}),o.readFile("./src/data/blog/blog.json","utf8",(l,c)=>{let r=JSON.parse(c),n={defaultPage:o.existsSync("./src/hooks/pages/blog.hbs")?o.readFileSync("./src/hooks/pages/blog.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/pages/blog.hbs","utf8"),singlePage:o.existsSync("./src/hooks/pages/blog-single.hbs")?o.readFileSync("./src/hooks/pages/blog-single.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/pages/blog-single.hbs","utf8"),defaultSection:o.existsSync("./src/hooks/sections/section-blog.hbs")?o.readFileSync("./src/hooks/sections/section-blog.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/sections/section-blog.hbs","utf8"),singleSection:o.existsSync("./src/hooks/sections/section-blog-single.hbs")?o.readFileSync("./src/hooks/sections/section-blog-single.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/sections/section-blog-single.hbs","utf8")};this.postPaginatorPage(r,n)});let a=o.existsSync("./src/hooks/pages/blog-find.hbs")?"./src/hooks/pages/blog-find.hbs":"./node_modules/blockit-builder/hooks/pages/blog-find.hbs";o.readFile(a,"utf8",(l,c)=>{let p=c.replace(/(?<=layout:\s).*/g,e.data.layout).replace(/(?<=title:\s).*/g,e.data.title).replace(/(?<=breadcrumb:\s).*/g,e.data.breadcrumb);o.writeFileSync("./src/pages/blog-find.hbs",p)})}):(o.writeFileSync(`./src/pages/${e.nameFile}.hbs`,e.data),e.currentBlog==="false"&&o.readFile("./src/data/setting.json","utf8",(t,s)=>{let i=JSON.parse(s);i.blog.asBlog=!1,o.writeFileSync("./src/data/setting.json",JSON.stringify(i,null,2))}))};readSectionData=e=>{let t=e.split("-").length>=4?`./src/partials/sections/${e}.hbs`:`./node_modules/blockit-builder/templates/${e}.hbs`;o.readFile(t,"utf8",(s,i)=>{let a={blocks:[{id:e,type:"code",data:{language:"HTML",text:i}}]};this.socket.emit("resultSectionData",a)})};createSectionData=(e,t)=>{e.forEach(s=>{o.readFile(`./node_modules/blockit-builder/templates/${s.reference}.hbs`,"utf8",(i,a)=>{a.includes("<!-- slideshow content begin -->")?o.writeFileSync(`./src/partials/sections/${s.reference}.hbs`,s.updateData===!1?a:s.updateData):o.writeFileSync(`./src/partials/sections/${s.reference}-${s.id}.hbs`,s.updateData===!1?a:s.updateData)})}),(t.length!==0||t[0]!==!1)&&t.forEach(s=>{try{o.existsSync(`./src/partials/sections/${s}.hbs`)&&o.unlinkSync(`./src/partials/sections/${s}.hbs`)}catch(i){console.error(`file not found: ${i}`)}})};createPostsData=()=>{o.readdir("./src/data/blog/posts",(e,t)=>{let s=t.map(i=>{let a=JSON.parse(o.readFileSync(`./src/data/blog/posts/${i}`,"utf8"));return{title:a.title,link:a.link,dateCreated:a.dateCreated,dateModified:a.dateModified,timeCreated:a.timeCreated,timeModified:a.timeModified,author:a.author,category:a.category,hidden:a.hidden}});this.socket.emit("postsData",s)})};createPostsActionData=e=>{let t=JSON.parse(o.readFileSync("./src/data/setting.json","utf8")),s=e==="empty"?null:JSON.parse(o.readFileSync(`./src/data/blog/posts/${e}.json`,"utf8")),i={authors:{current:s===null?"":s.author.name,select:t.authors},categories:{current:s===null?"":s.category,select:t.blog.categories},currentTags:s===null?"":s.tags,currentImage:s===null?!1:s.image,title:s===null?"":s.title,dateCreated:s===null?"":s.dateCreated,timeCreated:s===null?"":s.timeCreated,blocks:s===null?"":s.blocks,hidden:s===null?"":s.hidden};this.socket.emit("postsActionData",i)};postPaginatorWidget=(e,t,s,i)=>{let a=t||1,l=s||10,c=(a-1)*l,r=e.slice(c).slice(0,s),n=Math.ceil(e.length/l);return{page:a,perPage:l,prevPage:a-1?a-1:null,nextPage:n>a?a+1:null,totalPost:e.length,totalPages:n,displayAuthor:i.blog.displayAuthor,data:r}};postPaginatorPage=(e,t)=>{let s=JSON.parse(o.readFileSync("./src/data/setting.json","utf8"));setTimeout(()=>{let i=s.blog.postPerPage,a=this.postPaginatorWidget(e.post,1,i,s),{totalPages:l}=a;if(s.blog.asBlog!==!1){let d=1;for(;d<=l;){let u=`blog-page-${d}`,F=this.postPaginatorWidget(e.post.filter(G=>!G.hidden),d,i,s);o.writeFileSync(`./src/data/blog/${u}.json`,JSON.stringify(F,null,2));let m=t.defaultPage.replace(/(?<={{> section-blog-)(.*?)(?= }})/g,d);d===1?o.writeFileSync(`./src/pages/${s.blog.asBlog}`,m):o.writeFileSync(`./src/pages/blog-page-${d}.hbs`,m);let w=t.defaultSection.replace(/{{#each(.*?).data}}/g,`{{#each blogPage${d}.data}}`).replace(/{{#if(.*?).displayAuthor}}/g,`{{#if @root.blogPage${d}.displayAuthor}}`);o.writeFileSync(`./src/partials/blog/section-blog-${d}.hbs`,w),d++}}o.readdir("./src/data/blog",(d,u)=>{let F=u.filter(w=>w.match(/(blog-page-)/g)),m=l+1,g=F.length;for(;m<=g;)o.existsSync(`./src/data/blog/blog-page-${m}.json`)&&o.unlinkSync(`./src/data/blog/blog-page-${m}.json`),o.existsSync(`./src/pages/blog-page-${m}.hbs`)&&o.unlinkSync(`./src/pages/blog-page-${m}.hbs`),o.existsSync(`./dist/blog-page-${m}.html`)&&o.unlinkSync(`./dist/blog-page-${m}.html`),m++}),o.readdir("./src/partials/blog",(d,u)=>{let F=u.filter(g=>g.match(/section-blog/g)).sort((g,w)=>g.length-w.length).filter((g,w)=>w<l);u.filter(g=>g.match(/section-blog/g)).filter(g=>!F.includes(g)).forEach(g=>{o.existsSync(`./src/partials/blog/${g}`)&&o.unlinkSync(`./src/partials/blog/${g}`)})});let c=e.post.filter(d=>!d.hidden).slice(0,3).map(d=>({title:d.title,link:d.link,date:d.dateCreated})),n=e.post.map(d=>d.tags).filter(d=>d).reduce((d,u)=>d.concat(u),[]).map(d=>d),p=n.filter((d,u)=>n.indexOf(d)===u),D=e.post.map(d=>d.category),C=D.filter((d,u)=>D.indexOf(d)===u),S={asBlog:s.blog.asBlog===!1?!1:`${s.blog.asBlog.split(".").slice(0,-1)}.html`,totalPages:l,tagLists:p,latestPost:c};o.writeFileSync("./dist/blog/data/data-blog.json",JSON.stringify(S)),o.readFile("./src/data/blog/blog.json","utf8",(d,u)=>{let F=JSON.parse(u),m=C.map(g=>this.createCategoryPost(F.post,g));o.writeFileSync("./dist/blog/data/data-category.json",JSON.stringify(m))}),o.readFile("./src/data/blog/blog.json","utf8",(d,u)=>{let F=JSON.parse(u),m=p.map(g=>this.createTagPost(F.post,g));m.forEach(g=>{g.posts.forEach(w=>{delete w.tags,delete w.blocks})}),o.writeFileSync("./dist/blog/data/data-tag.json",JSON.stringify(m))})},600)};createCategoryPost=(e,t)=>{let s=e.filter(i=>i.category===t);return s.forEach(i=>{i.content=this.utils.trimString(i.blocks[0].data.text),i.date=i.dateCreated,delete i.author.id,delete i.blocks,delete i.share,delete i.category,delete i.tags,delete i.dateCreated,delete i.timeCreated,i.image||delete i.image}),{category:t,totalPost:s.length,posts:s}};createTagPost=(e,t)=>{let s=[];return e.forEach(i=>{i.tags.forEach(a=>{a===t&&s.push(i)})}),s.forEach(i=>{i.content=this.utils.trimString(i.blocks[0].data.text),i.date=i.dateCreated===void 0?i.date:i.dateCreated,delete i.author.id,delete i.share,delete i.dateCreated,delete i.timeCreated,i.image||delete i.image}),{tag:t,totalPost:s.length,posts:s}};postCreatePage=e=>{o.readdir("./src/data/blog/posts",(t,s)=>{let i={post:s.map(a=>JSON.parse(o.readFileSync(`./src/data/blog/posts/${a}`,"utf8")))};i.post.sort((a,l)=>new Date(`${l.dateCreated} ${l.timeCreated}`)-new Date(`${a.dateCreated} ${a.timeCreated}`)),o.readFile("./src/data/blog/blog.json","utf-8",(a,l)=>{let c=JSON.parse(l).post.map(n=>(delete n.dateModified,delete n.timeModified,n)),r=i.post.map(n=>(delete n.dateModified,delete n.timeModified,n));if(JSON.stringify(c)!==JSON.stringify(r)){let n={post:i.post.filter(p=>!p.hidden)};o.writeFileSync("./src/data/blog/blog.json",JSON.stringify(n,null,2))}}),this.postPaginatorPage(i,e)})};postsSaveContent=async(e,t,s)=>{o.unlink("./dist/blog/*.html",()=>{let i=s.singlePage.replace(/(?<={{> post-title)(.*?)(?= }})/g,`-${e}`);o.writeFileSync(`./src/data/blog/posts/${e}.json`,JSON.stringify(t,null,2)),t.hidden&&o.existsSync(`./dist/blog/${t.link}`)&&o.unlinkSync(`./dist/blog/${t.link}`),t.hidden===!1&&(o.writeFileSync(`./src/partials/blog/post-title-${e}.hbs`,s.singleSection),o.writeFileSync(`./src/pages/blog/${e}.hbs`,i)),this.postCreatePage(s)})};postsDeletePost=(e,t)=>{let s=[`./src/data/blog/posts/${e}.json`,`./src/pages/blog/${e}.hbs`,`./src/partials/blog/post-title-${e}.hbs`,`./dist/blog/${e}.html`];return Promise.all(s.map(i=>o.unlinkSync(i))).then(this.socket.emit("deleteDone","success"),this.postCreatePage(t))};createEditorData=e=>{o.readFile(`./src/data/blog/posts/${e}.json`,"utf8",(t,s)=>this.socket.emit("editorData",s))};postsTagSources=()=>{let e={defaultPage:o.existsSync("./src/hooks/pages/blog.hbs")?o.readFileSync("./src/hooks/pages/blog.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/pages/blog.hbs","utf8"),singlePage:o.existsSync("./src/hooks/pages/blog-single.hbs")?o.readFileSync("./src/hooks/pages/blog-single.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/pages/blog-single.hbs","utf8"),defaultSection:o.existsSync("./src/hooks/sections/section-blog.hbs")?o.readFileSync("./src/hooks/sections/section-blog.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/sections/section-blog.hbs","utf8"),singleSection:o.existsSync("./src/hooks/sections/section-blog-single.hbs")?o.readFileSync("./src/hooks/sections/section-blog-single.hbs","utf8"):o.readFileSync("./node_modules/blockit-builder/hooks/sections/section-blog-single.hbs","utf8")};this.socket.emit("tagSourcesData",e)};findBlogTitle=(e,t,s)=>{if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]===s)return e;for(let i of Object.keys(e))if(typeof e[i]=="object"){let a=this.findBlogTitle(e[i],t,s);if(a!==null&&typeof a<"u")return a}return null};createBlogTitle=e=>{if(this.findBlogTitle(e,"link","blog/page-1.html")!==null){let t=this.findBlogTitle(e,"link","blog/page-1.html").title;o.readdir("./src/pages/blog",(s,i)=>{i.forEach(a=>{o.readFile(`./src/pages/blog/${a}`,"utf8",(l,c)=>{let n=c.replace(/(?<=data-title=")([^"]*)/g,t.toLowerCase()).replace(/(?<=title:\s).*/g,t);o.writeFileSync(`./src/pages/blog/${a}`,n)})})})}};changeBlogFrontmatter=(e,t,s)=>{let c=(o.existsSync(t)?o.readFileSync(t,"utf8"):o.readFileSync(s,"utf8")).replace(/(?<=layout:\s).*/g,e.layout).replace(/(?<=title:\s).*/g,e.title).replace(/(?<=breadcrumb:\s).*/g,e.breadcrumb);o.existsSync(t)?o.writeFileSync(t,c):o.writeFileSync(s,c)};createNavigationData=()=>{let e={nav:JSON.parse(o.readFileSync("./src/data/navigation.json","utf8")),select:o.readdirSync("./src/pages","utf8").filter(t=>!t.match(/blog-page/g)&&!t.match(/blog-find/g)).filter(t=>t.match(/.(hbs)$/i))};this.socket.emit("navigationData",e)};saveNavigationData=e=>{o.writeFileSync("./src/data/navigation.json",JSON.stringify(e,null,2)),this.createBlogTitle(e)};assetsUpload=(e,t,s)=>{let i={};if(t.includes("author")?Object.assign(i,{width:72,height:72}):t.includes("featured")?Object.assign(i,{width:1130}):t.includes("post")?Object.assign(i,{width:980}):Object.assign(i,{width:null}),s==="svg"){let a=Z.optimize;o.writeFileSync(`./dist/img/user/${t}`,a(e).data),this.socket.emit("uploadDone",`img/user/${t}`)}else Y(e).resize(i).toFile(`./dist/img/user/${t}`,a=>{if(a)throw a;this.socket.emit("uploadDone",`img/user/${t}`)})};assetsDelete=e=>{o.existsSync(`./dist/img/user/${e}`)&&o.unlink(`./dist/img/user/${e}`,t=>{if(t)throw t;this.socket.emit("deleteDone","success")})};saveSettingsData=(e,t)=>{o.readFile("./src/assets/scss/_colors.scss","utf8",(s,i)=>{let a=i,u=a.replace(/(?<=primary:\s)([^;]*)/g,e.colors.primaryColor).replace(/(?<=secondary:\s)([^;]*)/g,e.colors.secondaryColor).replace(/(?<=success:\s)([^;]*)/g,e.colors.successColor).replace(/(?<=info:\s)([^;]*)/g,e.colors.infoColor).replace(/(?<=warning:\s)([^;]*)/g,e.colors.warningColor).replace(/(?<=danger:\s)([^;]*)/g,e.colors.dangerColor).replace(/(?<=light:\s)([^;]*)/g,e.colors.lightColor).replace(/(?<=dark:\s)([^;]*)/g,e.colors.darkColor).replace(/(?<=body-bg:\s)([^;]*)/g,e.colors.backgroundColor).replace(/(?<=body-color:\s)([^;]*)/g,e.colors.textColor).replace(/(?<=link-color:\s)([^;]*)/g,e.colors.linkColor);a!==u&&o.writeFileSync("./src/assets/scss/_colors.scss",u)}),o.readFile("./src/data/setting.json","utf-8",(s,i)=>{i!==JSON.stringify(e,null,2)&&o.writeFileSync("./src/data/setting.json",JSON.stringify(e,null,2)),this.postCreatePage(t),this.updateAuthorData(i,e,t),this.runMinifying(i,e)})};runMinifying=(e,t)=>{let s=t.optimization.minifyAssets.css,i=t.optimization.minifyAssets.js,a=JSON.parse(e).optimization.minifyAssets.css!==s,l=JSON.parse(e).optimization.minifyAssets.js!==i;a&&s?this.compiler.minifyCss():a&&!s&&this.compiler.buildCss(),l&&i?this.compiler.minifyJs():l&&!i&&this.compiler.buildJs()};saveEmail=e=>{o.readFile("./dist/sendmail.php","utf8",(t,s)=>{if(String(s.match(/(?<=emailTo = ).*/g))!==`"${e}";`){let a=s.replace(/(?<=emailTo = ).*/g,`"${e}";`);o.writeFileSync("./dist/sendmail.php",a)}})};saveMap=e=>{o.readdir("./src/partials/sections",(t,s)=>{s.filter(a=>a.match(/section-contact/g)).forEach(a=>{o.readFile(`./src/partials/sections/${a}`,"utf8",(l,c)=>{let r=c.split(`
`)[0],n=new A(c),p=n.window.document.querySelector("iframe");if(p!==null){p.src=e;let D=r.concat(`
`,n.window.document.documentElement.childNodes[1].innerHTML);o.writeFileSync(`./src/partials/sections/${a}`,D)}})})})};saveSocialMedia=()=>{let t=JSON.parse(o.readFileSync("src/data/component.json","utf8")).socialMedia.filter(s=>Object.values(s)[0].length!==0).map(s=>{let i=Object.keys(s)[0];return`	<div><a href="${Object.values(s)[0]}" class="color-${i} text-decoration-none"><i class="fab fa-${i==="facebook"?"facebook-square":i}"></i> ${i.charAt(0).toUpperCase()+i.slice(1)}</a></div>`}).join(`
`);o.readFile("src/partials/components/component-social-media.hbs","utf8",(s,i)=>{let a=i.split(`
`)[0],l=new A(i),c=l.window.document.querySelector(".social-media-list")===null?!1:l.window.document.querySelector(".social-media-list");c&&(c.innerHTML=`
${t}
`);let r=a.concat(`
`,l.window.document.documentElement.childNodes[1].innerHTML);o.writeFileSync("src/partials/components/component-social-media.hbs",r)})};saveFooter=()=>{let e=JSON.parse(o.readFileSync("./src/data/component.json","utf8")).footer;o.readFile("./src/partials/components/component-footer.hbs","utf8",(t,s)=>{let i=s.split(`
`)[0],a=new A(s),l=e.siteLogo.index,c=a.window.document.querySelector(".copyright-text"),r=a.window.document.querySelector(".footer-logo")===null?!1:a.window.document.querySelector(".footer-logo");e.siteLogo.exist&&(e.siteLogo.enabled?(r.children[l].classList.add("d-lg-inline-block"),r.children[l].classList.remove("d-none"),r.children[l].setAttribute("src",`{{root}}${e.siteLogo.logo.src}`),r.children[l].setAttribute("width",e.siteLogo.logo.width),r.children[l].setAttribute("height",e.siteLogo.logo.height)):(r.children[l].classList.add("d-none"),r.children[l].classList.remove("d-lg-inline-block"))),c.innerHTML=e.copyrightText;let n=a.window.document.documentElement.childNodes[1].innerHTML.replace(/&gt;/g,">"),p=i.concat(`
`,n);o.writeFileSync("./src/partials/components/component-footer.hbs",p)})};saveSlideshow=e=>{let t=o.readFileSync("./node_modules/blockit-builder/hooks/slideshow/slideshow-wrapper.hbs","utf8");o.existsSync("./src/hooks/slideshow/slideshow-wrapper.hbs")&&(t=o.readFileSync("./src/hooks/slideshow/slideshow-wrapper.hbs","utf8"));let s=["section-slideshow-1.hbs","section-slideshow-2.hbs","section-slideshow-3.hbs","section-slideshow-4.hbs"],i=e.map((l,c)=>l.slides.length===0?!1:c).filter(l=>l!==!1).map(l=>`section-slideshow-${l+1}.hbs`),a=s.filter(l=>!i.includes(l));e.forEach((l,c)=>{if(l.slides.length!==0){let r=l.slides.map(p=>p.text),n=t.replace(/\{{(.*slide-id)\}}/g,r.join(" "));o.writeFileSync(`./node_modules/blockit-builder/templates/section-slideshow-${c+1}.hbs`,n),o.writeFileSync(`./src/partials/sections/section-slideshow-${c+1}.hbs`,n)}}),o.readdir("./node_modules/blockit-builder/templates",(l,c)=>{c.filter(r=>a.includes(r)).forEach(r=>{o.unlinkSync(`./node_modules/blockit-builder/templates/${r}`),o.unlinkSync(`./src/partials/sections/${r}`)})})};createSettingsData=()=>{o.readFile("./src/data/setting.json","utf8",(e,t)=>this.socket.emit("settingsData",JSON.parse(t)))};createFooterData=()=>{o.readFile("./src/partials/components/component-footer.hbs","utf8",(e,t)=>{let s={blocks:[{id:"footer-content",type:"code",data:{language:"HTML",text:t}}]};this.socket.emit("footerData",s)})};saveFooterEditor=e=>{Object.keys(e).length!==0&&o.writeFileSync("./src/partials/components/component-footer.hbs",e)};createSlideItem=e=>{o.existsSync("./src/hooks/slideshow/slideshow-item.hbs")?this.createSlideData("./src/hooks/slideshow/slideshow-item.hbs",e):this.createSlideData("./node_modules/blockit-builder/hooks/slideshow/slideshow-item.hbs",e)};createSlideData=(e,t)=>{o.readFile(e,"utf8",(s,i)=>{let a={blocks:[{id:t,type:"code",data:{language:"HTML",text:i}}]};this.socket.emit("slideItem",a)})};createComponentsData=()=>{o.readFile("./src/data/component.json","utf8",(e,t)=>this.socket.emit("componentsData",JSON.parse(t)))};updateAuthorData=(e,t,s)=>{let i=JSON.parse(e).authors,a=t.authors,l=i.filter(this.utils.compareObj(a)),c=a.filter(this.utils.compareObj(i)),r=l.concat(c),n={post:[]};o.readdir("./src/data/blog/posts",(p,D)=>{D.forEach(C=>{let $=JSON.parse(o.readFileSync(`./src/data/blog/posts/${C}`,"utf8"));r.length!==0&&(Object.values($).forEach(S=>{(S.id===r[0].id&&S.name!==r[1].name||S.id===r[0].id&&S.avatar!==r[1].avatar)&&(S.name=r[1].name,S.avatar=r[1].avatar)}),o.writeFileSync(`./src/data/blog/posts/${C}`,JSON.stringify($,null,2))),n.post.push($)}),n.post.sort((C,$)=>new Date(`${$.dateCreated} ${$.timeCreated}`)-new Date(`${C.dateCreated} ${C.timeCreated}`)),o.writeFileSync("./src/data/blog/blog.json",JSON.stringify(n,null,2)),this.postPaginatorPage(n,s)})};saveComponentsData=e=>{o.writeFileSync("./src/data/component.json",JSON.stringify(e,null,2)),this.saveEmail(e.contactMap.email),this.saveMap(e.contactMap.mapSrc),this.saveSlideshow(e.slideshow),this.saveFooter(),this.saveSocialMedia()}};var M=class{constructor(e){this.blockit=e}dashboardSocket=e=>{e.on("getDashboardData",()=>this.blockit.createDashboardData())};pagesSocket=e=>{e.on("getPagesData",()=>this.blockit.createPagesData()),e.on("getPagesActionData",()=>this.blockit.createPagesActionData()),e.on("deletePageData",(t,s)=>this.blockit.pagesDeletePage(t,s)),e.on("savePageActionData",t=>this.blockit.pagesSavePage(t)),e.on("readSectionData",t=>this.blockit.readSectionData(t)),e.on("saveSectionData",(t,s)=>this.blockit.createSectionData(t,s))};navigationSocket=e=>{e.on("getNavigationData",()=>this.blockit.createNavigationData()),e.on("saveNavigation",t=>this.blockit.saveNavigationData(t))};postsSocket=e=>{e.on("getPostsData",()=>this.blockit.createPostsData()),e.on("deletePostData",(t,s)=>this.blockit.postsDeletePost(t,s)),e.on("getPostsActionData",t=>this.blockit.createPostsActionData(t)),e.on("savePostContent",(t,s,i)=>this.blockit.postsSaveContent(t,s,i)),e.on("getEditorData",t=>this.blockit.createEditorData(t)),e.on("triggerTagSources",()=>this.blockit.postsTagSources())};componentsSocket=e=>{e.on("getComponentsData",()=>this.blockit.createComponentsData()),e.on("saveComponents",t=>this.blockit.saveComponentsData(t)),e.on("getSlideItem",t=>this.blockit.createSlideItem(t))};settingsSocket=e=>{e.on("getSettingsData",()=>this.blockit.createSettingsData()),e.on("getFooterData",()=>this.blockit.createFooterData()),e.on("saveFooterEditor",t=>this.blockit.saveFooterEditor(t)),e.on("saveSettingsData",(t,s)=>this.blockit.saveSettingsData(t,s)),e.on("assetsUpload",(t,s,i)=>this.blockit.assetsUpload(t,s,i)),e.on("assetsDelete",t=>this.blockit.assetsDelete(t))}};import U from"browser-sync";var _=class{constructor(e,t){this.preview=U.create(),this.builder=U.create(),this.compiler=e,this.env=t}run=()=>{this.preview.init({port:3e3,ui:!1,notify:!1,open:!1,server:"./dist",callbacks:{ready:(e,t)=>{t.addMiddleware("*",(s,i)=>{i.writeHead(302,{location:"/404.html"}),i.end("Redirecting!")}),this.compiler.previewWatch(this.preview)}}}),this.builder.init({port:3001,ui:!1,notify:!1,server:"./node_modules/blockit-builder",single:!0,snippetOptions:{async:!1},logLevel:"silent",callbacks:{ready:(e,t)=>{t.io.sockets.on("connection",s=>{let i=new E(s),a=new M(i);a.dashboardSocket(s),a.pagesSocket(s),a.navigationSocket(s),a.postsSocket(s),a.componentsSocket(s),a.settingsSocket(s)}),this.compiler.builderWatch(this.builder,this.env)}}})}};var V="DEV",x=new P(V),ee=new _(x,V),B=new k,se=async()=>{B.logHeading(),x.buildClean(),x.buildHtml(),x.buildCss(),x.buildJs(),await x.buildImg(),x.buildStatic(),B.logMessage("completed")},te=()=>{B.logHeading(),ee.run()},ie=()=>process.argv.includes("--build")?se():te();ie();
