import l from"fs";import i from"cli-color";import c from"del";import o from"panini";import t from"gulp-rename";import r from"gulp-jsbeautifier";import s from"gulp-minifier";import p from"merge-stream";import n from"gulp-newer";import d from"gulp-concat";import f from"gulp-babel";import a from"gulp-postcss";import h from"@fullhuman/postcss-purgecss";import u from"autoprefixer";import g from"postcss-merge-longhand";import b from"gulp-sass";import y from"sass";import j,{gifsicle as w,mozjpeg as v,optipng as S,svgo as _}from"gulp-imagemin";import $ from"./utils.mjs";export default class J{constructor(e){Object.assign(this,e),this.utils=new $}reloadPanini=async()=>{await o.refresh()};buildClean=()=>c(["../../dist/**","../../dist/img/*","!../../dist/blog","!../../dist/blog/data","!../../dist/img","!../../dist/img/user"],{force:!0});buildHtml=()=>{const e=JSON.parse(l.readFileSync("../../src/data/setting.json","utf-8")).optimization.minifyAssets.html;return this.reloadPanini(),this.src("../../src/pages/**/*.hbs").pipe(o({root:"../../src/pages",layouts:"../../src/layouts",partials:"../../src/partials",data:"../../src/data",helpers:"./helpers"})).pipe(t(m=>m.extname=".html")).pipe(r({html:{file_types:[".html"],max_preserve_newlines:0,preserve_newlines:!0}})).pipe(e?s({minify:!0,minifyHTML:{collapseWhitespace:!0,removeComments:!0}}):s({minify:!1})).pipe(this.dest("../../dist")).on("end",()=>console.log(`${this.utils.logTime(new Date)} - HTML compiled ${i.green("successfully.")}`))};buildCss=()=>{const e=b(y);return this.src("../../src/assets/scss/main.scss").pipe(e()).pipe(t("style.css")).pipe(r({css:{file_types:[".css"]}})).pipe(a([u(),g()])).pipe(this.dest("../../dist/css")).on("end",()=>console.log(`${this.utils.logTime(new Date)} - CSS compiled ${i.green("successfully.")}`))};buildJs=()=>p(this.src("../../src/assets/js/*.js").pipe(r({js:{file_types:[".js"]}})).pipe(this.dest("../../dist/js")),this.src("../../src/assets/js/utilities/*.js").pipe(n("../../dist/js/vendors/utilities.min.js")).pipe(f({presets:[["@babel/preset-env",{targets:"> 0.25%, not dead",exclude:["babel-plugin-transform-async-to-generator","babel-plugin-transform-regenerator"]}]]})).pipe(d("utilities.min.js",{newLine:`\r
\r
`})).pipe(s({minify:!0,minifyJS:{sourceMap:!1}})).pipe(this.dest("../../dist/js")),this.src("../../src/assets/js/vendors/*.js").pipe(s({minify:!0,minifyJS:{sourceMap:!1}})).pipe(this.dest("../../dist/js/vendors")).on("end",()=>console.log(`${this.utils.logTime(new Date)} - JS compiled ${i.green("successfully.")}`)));buildImg=()=>this.src("../../src/assets/img/**/*").pipe(n("../../dist/img")).pipe(j([w({interlaced:!0}),v({quality:80,progressive:!0}),S({optimizationLevel:5}),_({plugins:[{name:"removeViewBox",active:!0},{name:"cleanupIDs",active:!1}]})],{verbose:!1,silent:!0})).pipe(this.dest("../../dist/img")).on("end",()=>console.log(`${this.utils.logTime(new Date)} - Images optimized ${i.green("successfully.")}`));buildStatic=()=>p(this.src("../../src/assets/fonts/*").pipe(this.dest("../../dist/fonts")),this.src(["../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-brands-400.ttf","../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-brands-400.woff2","../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-solid-900.ttf","../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-solid-900.woff2"]).pipe(this.dest("../../dist/fonts")),this.src("../../src/assets/favicon/favicon.ico").pipe(this.dest("../../dist/img")),this.src("../../src/assets/favicon/apple-touch-icon.png").pipe(this.dest("../../dist/img")),this.src("../../src/assets/php/sendmail.php").pipe(this.dest("../../dist")),this.src("../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js").pipe(s({minify:!0,minifyJS:{sourceMap:!1}})).pipe(t("bootstrap.min.js")).pipe(this.dest("../../dist/js/vendors")),this.src("../../node_modules/isotope-layout/dist/isotope.pkgd.min.js").pipe(t("isotope.min.js")).pipe(this.dest("../../dist/js/vendors")),this.src("../../node_modules/bigger-picture/dist/bigger-picture.min.js").pipe(this.dest("../../dist/js/vendors")).on("end",()=>console.log(`${this.utils.logTime(new Date)} - Static assets delivered ${i.green("successfully.")}`)));minifyCss=()=>this.src("../../dist/css/*.css").pipe(a([h({content:["../../dist/*.html","../../dist/js/**/*.js"],safelist:{standard:[/@s$/,/@m$/]}})])).pipe(s({minify:!0,minifyCSS:!0})).pipe(this.dest("../../dist/css"));minifyJs=()=>this.src("../../src/assets/js/*.js").pipe(s({minify:!0,minifyJS:{sourceMap:!1}})).pipe(this.dest("../../dist/js"));blockitWatch=()=>{this.watch("../../src/assets/scss/**/*.scss",this.series(this.buildCss)),this.watch("../../src/assets/js/**/*.js",this.series(this.buildJs)),this.watch("../../src/assets/img/**/*",this.series(this.buildImg)),this.watch(["../../src/**/*.hbs","../../src/data/**/*.json"],this.series(this.buildHtml)),this.watch(["../../src/hooks/blog/search-post.hbs","../../src/hooks/blog/search-result.hbs"],this.series(this.utils.hookSearch)),this.watch("../../src/hooks/sections/previews/*",this.series(this.utils.hookSectionsPreview))}}
