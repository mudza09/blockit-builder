import x from"gulp";const{src:s,dest:e,series:r,watch:n}=x;import i from"fs";import p from"cli-color";import J from"del";import u from"panini";import c from"gulp-rename";import m from"gulp-jsbeautifier";import o from"gulp-minifier";import f from"merge-stream";import d from"gulp-newer";import T from"gulp-concat";import D from"gulp-babel";import g from"gulp-postcss";import M from"@fullhuman/postcss-purgecss";import C from"autoprefixer";import H from"postcss-merge-longhand";import L from"gulp-sass";import z from"sass";import P,{gifsicle as I,mozjpeg as R,optipng as W,svgo as q}from"gulp-imagemin";import A from"./utils.mjs";const a=new A,B=async()=>{await u.refresh()},N=()=>J(["../../dist/**","../../dist/img/*","!../../dist/blog","!../../dist/blog/data","!../../dist/img","!../../dist/img/user"],{force:!0}),b=()=>{const t=JSON.parse(i.readFileSync("../../src/data/setting.json","utf-8")).optimization.minifyAssets.html;return B(),s("../../src/pages/**/*.hbs").pipe(u({root:"../../src/pages",layouts:"../../src/layouts",partials:"../../src/partials",data:"../../src/data",helpers:"./helpers"})).pipe(c(l=>l.extname=".html")).pipe(m({html:{file_types:[".html"],max_preserve_newlines:0,preserve_newlines:!0}})).pipe(t?o({minify:!0,minifyHTML:{collapseWhitespace:!0,removeComments:!0}}):o({minify:!1})).pipe(e("../../dist")).on("end",()=>console.log(`${a.logTime(new Date)} - HTML compiled ${p.green("successfully.")}`))},h=()=>{const t=L(z);return s("../../src/assets/scss/main.scss").pipe(t()).pipe(c("style.css")).pipe(m({css:{file_types:[".css"]}})).pipe(g([C(),H()])).pipe(e("../../dist/css")).on("end",()=>console.log(`${a.logTime(new Date)} - CSS compiled ${p.green("successfully.")}`))},y=()=>f(s("../../src/assets/js/*.js").pipe(m({js:{file_types:[".js"]}})).pipe(e("../../dist/js")),s("../../src/assets/js/utilities/*.js").pipe(d("../../dist/js/vendors/utilities.min.js")).pipe(D({presets:[["@babel/preset-env",{targets:"> 0.25%, not dead",exclude:["babel-plugin-transform-async-to-generator","babel-plugin-transform-regenerator"]}]]})).pipe(T("utilities.min.js",{newLine:`\r
\r
`})).pipe(o({minify:!0,minifyJS:{sourceMap:!1}})).pipe(e("../../dist/js")),s("../../src/assets/js/vendors/*.js").pipe(o({minify:!0,minifyJS:{sourceMap:!1}})).pipe(e("../../dist/js/vendors")).on("end",()=>console.log(`${a.logTime(new Date)} - JS compiled ${p.green("successfully.")}`))),j=()=>s("../../src/assets/img/**/*").pipe(d("../../dist/img")).pipe(P([I({interlaced:!0}),R({quality:80,progressive:!0}),W({optimizationLevel:5}),q({plugins:[{name:"removeViewBox",active:!0},{name:"cleanupIDs",active:!1}]})],{verbose:!1,silent:!0})).pipe(e("../../dist/img")).on("end",()=>console.log(`${a.logTime(new Date)} - Images optimized ${p.green("successfully.")}`)),O=()=>f(s("../../src/assets/fonts/*").pipe(e("../../dist/fonts")),s(["../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-brands-400.ttf","../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-brands-400.woff2","../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-solid-900.ttf","../../node_modules/@fortawesome/fontawesome-free/webfonts/fa-solid-900.woff2"]).pipe(e("../../dist/fonts")),s("../../src/assets/favicon/favicon.ico").pipe(e("../../dist/img")),s("../../src/assets/favicon/apple-touch-icon.png").pipe(e("../../dist/img")),s("../../src/assets/php/sendmail.php").pipe(e("../../dist")),s("../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js").pipe(o({minify:!0,minifyJS:{sourceMap:!1}})).pipe(c("bootstrap.min.js")).pipe(e("../../dist/js/vendors")),s("../../node_modules/isotope-layout/dist/isotope.pkgd.min.js").pipe(c("isotope.min.js")).pipe(e("../../dist/js/vendors")),s("../../node_modules/bigger-picture/dist/bigger-picture.min.js").pipe(e("../../dist/js/vendors")).on("end",()=>console.log(`${a.logTime(new Date)} - Static assets delivered ${p.green("successfully.")}`))),U=()=>{n("../../src/assets/scss/**/*.scss",r(h)),n("../../src/assets/js/**/*.js",r(y)),n("../../src/assets/img/**/*",r(j)),n(["../../src/**/*.hbs","../../src/data/**/*.json"],r(b)),n(["../../src/hooks/blog/search-post.hbs","../../src/hooks/blog/search-result.hbs"],r(V)),n("../../src/hooks/sections/previews/*",r(E))},V=t=>{i.existsSync("../../src/hooks/blog/search-post.hbs")&&i.existsSync("../../src/hooks/blog/search-result.hbs")?(w("../../src/hooks/blog/search-post.hbs","../../src/hooks/blog/search-result.hbs"),t()):(w("hooks/blog/search-post.hbs","hooks/blog/search-result.hbs"),t())},w=(t,l)=>{const v=i.readFileSync(t,"utf8"),S=i.readFileSync(l,"utf8");i.readFile("../../src/assets/js/utilities/blog.js","utf8",(Q,k)=>{const F=/(?<=notFoundDiv.innerHTML\s=\s\`)([^`]*)(?=\`)/,_=/(?<=return\s\`)([^`]*)(?=\`)/g,$=k.replace(F,S).replace(_,v);i.writeFileSync("../../src/assets/js/utilities/blog.js",$)})},E=()=>s("../../src/hooks/sections/previews/*").pipe(e("./views/assets/img/sections")),G=()=>s("../../dist/css/*.css").pipe(g([M({content:["../../dist/*.html","../../dist/js/**/*.js"],safelist:{standard:[/@s$/,/@m$/]}})])).pipe(o({minify:!0,minifyCSS:!0})).pipe(e("../../dist/css")),K=()=>s("../../src/assets/js/*.js").pipe(o({minify:!0,minifyJS:{sourceMap:!1}})).pipe(e("../../dist/js"));export{N as buildClean,b as buildHtml,h as buildCss,y as buildJs,j as buildImg,O as buildStatic,U as blockitWatch,G as minifyCss,K as minifyJs};
